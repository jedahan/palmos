<html>
<!-- Mirrored from users.fuw.edu.pl/~michalj/palmos/DebuggingStrats.html by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 17 Feb 2015 19:10:17 GMT -->
<head><title>Debugging Strategies</title></head><body bgcolor="#ffffff"><TABLE WIDTH="100%">  <TR>    <TD WIDTH=25%><a href="Localization.html"><IMG SRC="images/prev.html" BORDER=0 ALT="Previous Page"></TD>    <TD WIDTH=25%><a href="CompanionTOC.html"><IMG SRC="images/content.gif" BORDER=0 ALT="Table of Contents"></TD>    <TD WIDTH=25%><a href="CompanionIX.html"><IMG SRC="images/index.gif" BORDER=0 ALT="Index"></TD>    <TD WIDTH=25%><a href="StandardIOApp.html"><IMG SRC="images/next.html" BORDER=0 ALT="Next Page"></TD>  </TR></TABLE><br><center><B>Palm OS Programmer's Companion</B></center><hr><br><a name="924904"> </a><h1><IMG SRC="images/PCPplain.gif" ALT="Palm Logo" WIDTH="45" HEIGHT="44"> <a name="924902"> </a>14 Debugging Strategies</h1><dl><a name="924907"> </a><p></p><dt>You can use a Palm OS<sup>&#174;</sup> system manager called the error manager to display unexpected runtime errors such as those that typically show up during program development. Final versions of applications or system software won't use the error manager. <a name="924908"> </a><p></p><dt>The error manager API consists of a set of functions for displaying an alert with an error message, file name, and the line number where the error occurred. If a debugger is connected, it is entered when the error occurs.<a name="924909"> </a><p></p><dt>The error manager also provides a "try and catch" mechanism that applications can use for handling such runtime errors as out of memory conditions, user input errors, etc. <a name="924910"> </a><p></p><dt>This section helps you understand and use the error manager, discussing the following topics:<ul type="SQUARE"><a name="924914"> </a><br><li><a href="DebuggingStrats.html#924929">Displaying Development Errors</a><br><a name="924918"> </a><br><li><a href="DebuggingStrats.html#924992">Understanding the Try-and-Catch Mechanism</a><br><a name="924922"> </a><br><li><a href="DebuggingStrats.html#924965">Using the Error Manager Macros</a><br><a name="924926"> </a><br><li><a href="DebuggingStrats.html#925051">Summary of Debugging API</a><br></ul><a name="924927"> </a><p></p><dt>This chapter only describes programmatic debugging strategies; to learn how to use the available tools to debug your application, see the book <em>Palm OS Programming Development Tools Guide</em>. </dl><a name="924929"> </a><h3> Displaying Development Errors</h3><dl><a name="924930"> </a><p></p><dt>The error manager provides some compiler macros that can be used in source code. These macros display a fatal alert dialog on the screen and provide buttons to reset the device or enter the debugger after the error is displayed. There are three macros: <code><a href="ErrorManager.html#926007"></code>ErrDisplay<code></a></code>, <code><a href="ErrorManager.html#925092"></code>ErrFatalDisplayIf<code></a></code>, and <code><a href="ErrorManager.html#925117"></code>ErrNonFatalDisplayIf<code></a></code>. <ul type="SQUARE"><a name="924941"> </a><br><li><code>ErrDisplay</code> always displays the error message on the screen.<br><a name="924943"> </a><br><li><code>ErrFatalDisplayIf</code> and <code></code><code>ErrNonFatalDisplayIf</code> display the error message only if their first argument is <code>TRUE.</code><br></ul><a name="924945"> </a><p></p><dt>The error manager uses the compiler define <code>ERROR_CHECK_LEVEL</code> to control the level of error messages displayed. You can set the value of the compiler define to control which level of error checking and display is compiled into the application. Three levels of error checking are supported: none, partial, and full.<p><a name="925221"> </a> </p><p><div> <table border="3"><caption><B></B></caption><tr><th><a name="924948"> </a><strong>If you set ERR_CHECK_LEVEL to...</strong></th><th><a name="924950"> </a><strong>The compiler...</strong></th></tr><tr><td><a name="924952"> </a><code>ERROR_CHECK_NONE (0)</code></td><td><a name="924954"> </a>Doesn't compile in any error calls.</td></tr><tr><td><a name="924956"> </a><code>ERROR_CHECK_PARTIAL</code> <code>(1)</code></td><td><a name="924958"> </a>Compiles in only <code>ErrDisplay</code> and <code></code><code>ErrFatalDisplayIf</code> calls.</td></tr><tr><td><a name="924960"> </a><code>ERROR_CHECK_FULL</code> <code>(2)</code></td><td><a name="924962"> </a>Compiles in all three calls.</td></tr></table><table><tr><td></table></div></p><a name="924963"> </a><p></p><dt>During development, it makes sense to set full error checking for early development, partial error checking during alpha and beta test periods, and no error checking for the final product. At partial error checking, only fatal errors are displayed; error conditions that are only possible are ignored under the assumption that the application developer is already aware of the condition and designed the software to operate that way. </dl><a name="924965"> </a><h3> Using the Error Manager Macros</h3><dl><a name="924966"> </a><p></p><dt>Calls to the error manager to display errors are actually compiler macros that are conditionally compiled into your program. Most of the calls take a boolean parameter, which should be set to <code>true</code> to display the error, and a pointer to a text message to display if the condition is true. <a name="924967"> </a><p></p><dt>Typically, the boolean parameter is an in-line expression that evaluates to <code>true</code> if there is an error condition. As a result, both the expression that evaluates the error condition and the message text are left out of the compiled code when error checking is turned off. You can call <code><a href="ErrorManager.html#925092"></code>ErrFatalDisplayIf<code></a></code>, or <code><a href="ErrorManager.html#926007"></code>ErrDisplay<code></a></code>, but using <code>ErrFatalDisplayIf</code> makes your source code look neater. <a name="924974"> </a><p></p><dt>For example, assume your source code looks like this:<dl><a name="924975"> </a><br><code>result = DoSomething();</code><br></dl><dl><a name="924977"> </a><code>ErrFatalDisplayIf (result &lt; 0, <br>	 "unexpected result from DoSomething");</code><br><dl><a name="924978"> </a><p></p><dt>With error checking turned on, this code displays an error alert dialog if the result from <code>DoSomething()</code> is less than 0. Besides the error message itself, this alert also shows the file name and line number of the source code that called the error manager. With error checking turned off, both the expression evaluation <code>err &lt; 0</code> and the error message text are left out of the compiled code. <a name="924979"> </a><p></p><dt>The same net result can be achieved by the following code:</dl></dl><dl><a name="924980"> </a><br><code>result = DoSomething();</code><br></dl><dl><a name="924982"> </a><code>#if ERROR_CHECK_LEVEL != ERROR_CHECK_NONE</code><br><a name="924983"> </a><code>if (result &lt; 0) </code><br><a name="924985"> </a><code>&nbsp&nbsp&nbsp ErrDisplay ("unexpected result from DoSomething");</code><br><a name="924986"> </a><code>#endif</code><br><dl><a name="924987"> </a><p></p><dt>However, this solution is longer and requires more work than simply calling <code><a href="ErrorManager.html#925092"></code>ErrFatalDisplayIf<code></a></code>. It also makes the source code harder to follow.</dl></dl></dl><a name="924992"> </a><h3> Understanding the Try-and-Catch Mechanism</h3><dl><a name="924994"> </a><p></p><dt>The error manager is aware of the machine state of the Palm OS device and can therefore correctly save and restore this state. The built-in try and catch of the compiler can't be used because it's machine dependent.<a name="924995"> </a><p></p><dt>Try and catch is basically a neater way of implementing a <code>goto</code> if an error occurs. A typical way of handling errors in the middle of a routine is to go to the end of the routine as soon as an error occurs and have some general-purpose cleanup code at the end of every routine. Errors in nested routines are even trickier because the result code from every subroutine call must be checked before continuing. <a name="924996"> </a><p></p><dt>When you set up a try/catch, you are providing the compiler with a place to jump to when an error occurs. You can go to that error handling routine at any time by calling <code><a href="ErrorManager.html#925140"></code>ErrThrow<code></a></code>. When the compiler sees the ErrThrow call, it performs a <code>goto</code> to your error handling code. The greatest advantage to calling ErrThrow, however, is for handling errors in nested subroutine calls. <a name="925001"> </a><p></p><dt>Even if ErrThrow<code> </code>is called from a nested subroutine, execution immediately goes to the same error handling code in the higher-level call. The compiler and runtime environment automatically strip off the stack frames that were pushed onto the stack during the nesting process and go to the error handling section of the higher-level call. You no longer have to check for result codes after calling every subroutine; this greatly simplifies your source code and reduces its size. </dl><a name="925002"> </a><h3> Using the Try and Catch Mechanism</h3><dl><a name="925004"> </a><p></p><dt>The following example illustrates the possible layout for a typical routine using the error manager's try and catch mechanism.</dl><a name="925005"> </a><h4>Listing 14.1	 Try and Catch Mechanism Example</h4><a name="925006"> </a><hr><code>&nbsp&nbsp&nbsp 	 ErrTry {</code><br><a name="925007"> </a><code> 	 	 	 p = MemPtrNew(1000);</code><br><a name="925008"> </a><code>&nbsp&nbsp&nbsp 	 	 if (!p) ErrThrow(errNoMemory);</code><br><a name="925009"> </a><code>&nbsp&nbsp&nbsp 	 	 MemSet(p, 1000, 0);</code><br><a name="925010"> </a><code>&nbsp&nbsp&nbsp 	 	 CreateTable(p);</code><br><a name="925011"> </a><code>&nbsp&nbsp&nbsp 	 	 PrintTable(p);</code><br><a name="925012"> </a><code> 	 	 	 }</code><br><a name="925013"> </a><code> </code><br><a name="925014"> </a><code> 	 	 ErrCatch(err) {</code><br><a name="925015"> </a><code>  	 	 	 // Recover or clean up after a failure in the </code><br><a name="925016"> </a><code> 	 	 	 // above Try block."err" is an int </code><br><a name="925017"> </a><code> 	 	 	 // identifying the reason for the failure.</code><br><a name="925018"> </a><code> 	 	 	 </code><br><a name="925019"> </a><code> 	 	 	 // You may call ErrThrow() if you want to </code><br><a name="925020"> </a><code> 	 	 	 // jump out to the next Catch block.</code><br><a name="925021"> </a><code> </code><br><a name="925022"> </a><code> 	 	 	 // The code in this Catch block doesn't </code><br><a name="925023"> </a><code> 	 	 	 // execute if the above Try block completes</code><br><a name="925024"> </a><code>&nbsp&nbsp&nbsp 	 	 // without a Throw.</code><br><a name="925025"> </a><code> </code><br><a name="925026"> </a><code>&nbsp&nbsp&nbsp 	 	 if (err == errNoMemory)</code><br><a name="925027"> </a><code>&nbsp&nbsp&nbsp 	 	 	 ErrDisplay("Out of Memory");</code><br><a name="925028"> </a><code>&nbsp&nbsp&nbsp 	 	 else</code><br><a name="925029"> </a><code>&nbsp&nbsp&nbsp 	 	 	 ErrDisplay("Some other error");</code><br><a name="925030"> </a><code> 	 	 	 } ErrEndCatch</code><br><a name="925031"> </a><code>&nbsp&nbsp&nbsp 	 	 // You must structure your code exactly as </code><br><a name="925032"> </a><code> 	 	 	 //	 above. You can't have an ErrTry without an </code><br><a name="925033"> </a><code>&nbsp&nbsp&nbsp 	 	 //ErrCatch { } ErrEndCatch, or vice versa.</code><br><hr><br><dl><a name="925037"> </a><p></p><dt>Any call to <a href="ErrorManager.html#925140">ErrThrow</a> within the <code>ErrTry</code> block results in control passing immediately to the <code>ErrCatch</code> block. Even if the subroutine <code>CreateTable</code> called ErrThrow, control would pass directly to the <code>ErrCatch</code> block. If the <code>ErrTry</code> block completes without calling <code>ErrThrow</code>, the <code>ErrCatch</code> block is not executed.<a name="925038"> </a><p></p><dt>You can nest multiple <code>ErrTry</code> blocks. For example, if you wanted to perform some cleanup at the end of <code>CreateTable</code> in case of error, <ul type="SQUARE"><a name="925039"> </a><br><li>Put <code>ErrTry</code>/<code>ErrCatch</code> blocks in <code>CreateTable</code> <br><a name="925040"> </a><br><li>Clean up in the <code>ErrCatch</code> block first<br><a name="925044"> </a><br><li>Call <code><a href="ErrorManager.html#925140"></code>ErrThrow<code></a></code> to jump to the top-level <code>ErrCatch</code><br></ul></dl><a name="925051"> </a><h3> Summary of Debugging API</h3><p><a name="925085"> </a> </p><p><div> <table border="3"><caption><B></B></caption><tr><th><a name="925054"> </a><strong>Error Manager Functions</strong></th><th><a name="925056"> </a><strong></strong></th></tr><tr><td><a name="925061"> </a><a href="ErrorManager.html#926007">ErrDisplay</a></td><td><a name="925066"> </a><a href="ErrorManager.html#925058">ErrDisplayFileLineMsg</a></td></tr><tr><td><a name="925071"> </a><a href="ErrorManager.html#925092">ErrFatalDisplayIf</a></td><td><a name="925076"> </a><a href="ErrorManager.html#925117">ErrNonFatalDisplayIf</a></td></tr><tr><td><a name="925082"> </a><a href="ErrorManager.html#925140">ErrThrow</a></td><td><a name="925084"> </a><a href="ErrorManager.html#924949">ErrAlert</a></td></tr></table><table><tr><td></table></div></p><dl><a name="925095"> </a><p></p><dt><strong></strong></dl><hr><br><center><B>Palm OS Programmer's Companion</B></center><br><TABLE WIDTH="100%">  <TR>    <TD WIDTH=10%>&nbsp</TD>    <TD WIDTH=20%><a href="Localization.html"><IMG SRC="images/prev.html" BORDER=0 ALT="Previous Page"></TD>    <TD WIDTH=20%><a href="CompanionTOC.html"><IMG SRC="images/content.gif" BORDER=0 ALT="Table of Contents"></TD>    <TD WIDTH=20%><a href="CompanionIX.html"><IMG SRC="images/index.gif" BORDER=0 ALT="Index"></TD>    <TD WIDTH=20%><a href="StandardIOApp.html"><IMG SRC="images/next.html" BORDER=0 ALT="Next Page"></TD>    <TD WIDTH=10%>&nbsp</TD>  </TR></TABLE><br><small><em>This is page 83 of 85 in this book</em></small><hr><br><address><a href="http://www.palmos.com/dev/">Palm Computing Platform Development Zone</a></address><i>Copyright &#169; 2000, Palm, Inc.   All rightsreserved.</i><!-- This file was created with Quadralay WebWorks Publisher 5.0.2 --><!-- --><!-- For more information on how this document, and how the rest of --><!-- this server was created, email devsupp@palm.com --><!-- --><!-- Last updated: 03/27/00 21:29:50 --></body>
<!-- Mirrored from users.fuw.edu.pl/~michalj/palmos/DebuggingStrats.html by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 17 Feb 2015 19:10:17 GMT -->
</html>