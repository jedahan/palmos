<html>
<!-- Mirrored from users.fuw.edu.pl/~michalj/palmos/StandardIOApp.html by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 17 Feb 2015 19:10:17 GMT -->
<head><title>Standard IO Applications</title></head><body bgcolor="#ffffff"><TABLE WIDTH="100%">  <TR>    <TD WIDTH=25%><a href="DebuggingStrats.html"><IMG SRC="images/prev.html" BORDER=0 ALT="Previous Page"></TD>    <TD WIDTH=25%><a href="CompanionTOC.html"><IMG SRC="images/content.gif" BORDER=0 ALT="Table of Contents"></TD>    <TD WIDTH=25%><a href="CompanionIX.html"><IMG SRC="images/index.gif" BORDER=0 ALT="Index"></TD>    <TD WIDTH=25%><a href="CompanionIX.html"><IMG SRC="images/next.html" BORDER=0 ALT="Next Page"></TD>  </TR></TABLE><br><center><B>Palm OS Programmer's Companion</B></center><hr><br><a name="914017"> </a><h1><IMG SRC="images/PCPplain.gif" ALT="Palm Logo" WIDTH="45" HEIGHT="44"> <a name="914015"> </a>15 Standard IO Applications</h1><dl><a name="913250"> </a><p></p><dt>The Palm OS<sup>&#174;</sup> supports command line (UNIX style) applications for debugging and special purposes such as communications utilities. This capability is not intended for general users, but for developers. This feature is not implemented in the Palm OS, but rather by additional C modules that you must link with your application.<a name="913251"> </a><blockquote><hr><strong>NOTE: &nbsp</strong><p></p>Don't confuse this standard IO functionality with the file streaming API. They are unrelated.<hr><br></blockquote><a name="913252"> </a><p></p><dt>There are two parts necessary for a standard IO application:<ul type="SQUARE"><a name="913253"> </a><br><li>The standard IO application itself.<br><dl><a name="913254"> </a><p></p><dt>A standard IO application is not like a normal Palm application. It is executed by a command line and has minimal user interface. It can take character input from the stdin device (the keyboard) and write character output to the stdout window.</dl><a name="913255"> </a><br><li>The standard IO provider application.<br><dl><a name="913256"> </a><p></p><dt>A standard IO provider application is necessary to execute and see output from a standard IO application. The standard IO provider application is a normal Palm application that provides a field in which you can enter commands to execute standard IO applications. The field also serves as a stdout window where output from the executing application is written.</dl></ul><a name="913257"> </a><p></p><dt>The details of creating these two different applications are described in the following sections.</dl><a name="913258"> </a><h2> Creating a Standard IO Application</h2><dl><a name="913259"> </a><p></p><dt>To create a standard IO application, you must include the header file <code>StdIOPalm.h</code>. In addition to including this header, you must link the application with the module <code>StdIOPalm.c</code>. This module provides a <code>PilotMain</code> routine that extracts the command line arguments from the <code>cmd</code> and <code>cmdPBP</code> parameters and the glue code necessary for executing the appropriate callbacks supplied by the standard IO provider application.<a name="913260"> </a><p></p><dt>You build the application normally, but give it a database type of <code>sioDBType</code> ('sdio') instead of 'appl'. In addition, it must be named "Cmd-<em>cmdname</em>" where <em>cmdname</em> is the name of the command used to execute the application. For example, the ping command would be placed in a database named "Cmd-ping".<a name="913261"> </a><p></p><dt>In the Palm VII<sup>&#153;</sup> device, the Network panel, whose log window is a standard IO provider application, has two standard IO commands built-in: info and finger. The ROM has two additional ones: ping and nettrace.<a name="913262"> </a><p></p><dt>When compiling for the Palm device, the entry point must be named <code>SioMain</code> and must accept two parameters: <code>argc</code> and <code>argv</code>. Here's the simplest possible example of a standard IO application.<dl><a name="913263"> </a><br><code>#include &lt;StdIOPalm.h&gt;</code><br></dl><dl><a name="913264"> </a><code>Int16 SioMain(UInt16 argc, Char* argv[ ])</code><br><a name="913265"> </a><code>{ printf("Hello World\n");</code><br><a name="913266"> </a><code>}</code><br><dl><a name="913267"> </a><p></p><dt>Standard IO applications can use several input and output functions that mimic their similarly named UNIX counterparts. These are listed in the <a href="StandardIOApp.html#913443">summary table</a> at the end of this chapter.<a name="913269"> </a><p></p><dt>Your standard IO application can accept input from stdin and write output to stdout. The stdin device corresponds to the text field in the standard IO provider application that is used for input and output. The stdout device corresponds to that same text field.</dl></dl></dl><a name="913270"> </a><h2> Creating a Standard IO Provider Application</h2><dl><a name="913271"> </a><p></p><dt>In order for a standard IO application to be invoked and able to provide results, you need a standard IO provider application. This application provides the user interface support; that is, the stdin device support and the stdout window that the standard IO application reads from and writes to.<a name="913272"> </a><p></p><dt>The standard IO provider sublaunches the standard IO application when the user types in a command line and Return (using Graffiti<sup>&#174;</sup>). The provider application passes a structure pointer that contains the callbacks necessary for performing IO to the standard IO application through the <code>cmdPBP</code> parameter of <code>PilotMain</code>.<a name="913273"> </a><p></p><dt>To create a standard IO provider application, you must link the application with the module <code>StdIOProvider.c</code>.<a name="913274"> </a><p></p><dt>To handle input and output, the standard IO provider application must provide a form with a text field and a scroll bar. The standard IO provider application must do the following: </dl>  <a name="913278"> </a><font face="">Call <code><a href="StandardIO.html#925221"></code>SioInit<code></a></code> during application initialization. <code>SioInit</code> saves the object ID of the form that contains the input/output field, the field itself, and the scroll bar.</font>  <a name="913282"> </a><font face="">Call <code><a href="StandardIO.html#925208"></code>SioHandleEvent<code></a></code> from the form's event handler before doing application specific processing of the event. In other words, the form event handler that the application installs with <code>FrmSetEventHandler</code> should call <code>SioHandleEvent</code> before it does anything else with the event.</font>  <a name="913286"> </a><font face="">Call <code><a href="StandardIO.html#925199"></code>SioFree<code></a></code> during application shutdown.</font><dl><a name="913287"> </a><p></p><dt>The application is free to call any of the standard IO macros and functions between the <code>SioInit</code> and <code>SioFree</code> calls. If the current form is not the standard IO form when these calls are made, they will record changes to the active text and display it the next time the form becomes active. <a name="913288"> </a><p></p><dt>A typical standard IO provider application will have a routine called <code>ApplicationHandleEvent</code>, which gets called from its main event loop after <code>SysHandleEvent</code> and <code>MenuHandleEvent</code>. An example is shown in <a href="StandardIOApp.html#913293">Listing 15.1</a>.</dl><a name="913293"> </a><h4>Listing 15.1	 Standard IO Provider ApplicationHandleEvent Routine</h4><a name="913294"> </a><hr><code>&nbsp&nbsp&nbsp static Boolean ApplicationHandleEvent (EventPtr event)</code><br><a name="913295"> </a><code>&nbsp&nbsp&nbsp {</code><br><a name="913296"> </a><code>&nbsp&nbsp&nbsp 	 FormType* frm;</code><br><a name="913297"> </a><code>&nbsp&nbsp&nbsp 	 UInt16 formId;</code><br><a name="913298"> </a><code></code><br><a name="913299"> </a><code>&nbsp&nbsp&nbsp 	 if (event-&gt;eType == frmLoadEvent) {</code><br><a name="913300"> </a><code>&nbsp&nbsp&nbsp 	 	 formId = event-&gt;data.frmLoad.formID;</code><br><a name="913301"> </a><code>&nbsp&nbsp&nbsp 	 	 frm = FrmInitForm (formId);</code><br><a name="913302"> </a><code>&nbsp&nbsp&nbsp 	 	 FrmSetActiveForm (frm);	 	 </code><br><a name="913303"> </a><code>&nbsp&nbsp&nbsp 	 	 </code><br><a name="913304"> </a><code>&nbsp&nbsp&nbsp 	 	 switch (formId) {</code><br><a name="913305"> </a><code>&nbsp&nbsp&nbsp 	 	 	 .....</code><br><a name="913306"> </a><code>&nbsp&nbsp&nbsp 	 	 	 case myViewWithStdIO:</code><br><a name="913307"> </a><code>&nbsp&nbsp&nbsp 	 	 	 	 FrmSetEventHandler (frm, MyViewHandleEvent);</code><br><a name="913308"> </a><code>&nbsp&nbsp&nbsp 	 	 	 	 break;</code><br><a name="913309"> </a><code>&nbsp&nbsp&nbsp 	 	 	 }</code><br><a name="913310"> </a><code>&nbsp&nbsp&nbsp 	 	 return (true);</code><br><a name="913311"> </a><code>&nbsp&nbsp&nbsp 	 	 }	  </code><br><a name="913312"> </a><code></code><br><a name="913313"> </a><code>&nbsp&nbsp&nbsp 	 return (false);</code><br><a name="913314"> </a><code>&nbsp&nbsp&nbsp 	 }	  </code><br><hr><br><dl><a name="913318"> </a><p></p><dt>A typical application form event handler is shown in <a href="StandardIOApp.html#913320">Listing 15.2</a>.</dl><a name="913320"> </a><h4>Listing 15.2	 Standard IO Provider Form Event Handler</h4><a name="913321"> </a><hr><code>&nbsp&nbsp&nbsp static Boolean MyViewHandleEvent (EventPtr event)</code><br><a name="913322"> </a><code>&nbsp&nbsp&nbsp {</code><br><a name="913323"> </a><code>&nbsp&nbsp&nbsp 	 FormType* frm;</code><br><a name="913324"> </a><code>&nbsp&nbsp&nbsp 	 Boolean handled = false;</code><br><a name="913325"> </a><code></code><br><a name="913326"> </a><code>&nbsp&nbsp&nbsp 	 // Let StdIO handler do its thing first.</code><br><a name="913327"> </a><code>&nbsp&nbsp&nbsp 	 if (SioHandleEvent(event)) return true;</code><br><a name="913328"> </a><code></code><br><a name="913329"> </a><code>&nbsp&nbsp&nbsp 	 // If StdIO did not completely handle the event...</code><br><a name="913330"> </a><code>&nbsp&nbsp&nbsp 	 if (event-&gt;eType == ctlSelectEvent) {	 	 </code><br><a name="913331"> </a><code>&nbsp&nbsp&nbsp 	 	 switch (event-&gt;data.ctlSelect.controlID) {</code><br><a name="913332"> </a><code>&nbsp&nbsp&nbsp 	 	 	 case myViewDoneButtonID:</code><br><a name="913333"> </a><code>&nbsp&nbsp&nbsp 	 	 	 	 FrmGotoForm (networkFormID);</code><br><a name="913334"> </a><code>&nbsp&nbsp&nbsp 	 	 	 	 handled = true;</code><br><a name="913335"> </a><code>&nbsp&nbsp&nbsp 	 	 	 	 break;</code><br><a name="913336"> </a><code>&nbsp&nbsp&nbsp 	 	 	 }</code><br><a name="913337"> </a><code>&nbsp&nbsp&nbsp 	 	 }</code><br><a name="913338"> </a><code></code><br><a name="913339"> </a><code>&nbsp&nbsp&nbsp 	 else if (event-&gt;eType == menuEvent) </code><br><a name="913340"> </a><code>&nbsp&nbsp&nbsp 	 	 return MyMenuDoCommand( event-&gt;data.menu.itemID );</code><br><a name="913341"> </a><code>&nbsp&nbsp&nbsp 	 	 </code><br><a name="913342"> </a><code>&nbsp&nbsp&nbsp 	 else if (event-&gt;eType == frmUpdateEvent) {</code><br><a name="913343"> </a><code>&nbsp&nbsp&nbsp 	 	 MyViewDraw( FrmGetActiveForm() );</code><br><a name="913344"> </a><code>&nbsp&nbsp&nbsp 	 	 handled = true;</code><br><a name="913345"> </a><code>&nbsp&nbsp&nbsp 	 	 }</code><br><a name="913346"> </a><code></code><br><a name="913347"> </a><code>&nbsp&nbsp&nbsp 	 else if (event-&gt;eType == frmOpenEvent) {</code><br><a name="913348"> </a><code>&nbsp&nbsp&nbsp 	 	 frm = FrmGetActiveForm();</code><br><a name="913349"> </a><code>&nbsp&nbsp&nbsp 	 	 MyViewInit( frm );</code><br><a name="913350"> </a><code>&nbsp&nbsp&nbsp 	 	 MyViewDraw( frm );</code><br><a name="913351"> </a><code>&nbsp&nbsp&nbsp 	 	 handled = true;</code><br><a name="913352"> </a><code>&nbsp&nbsp&nbsp 	 	 }</code><br><a name="913353"> </a><code></code><br><a name="913354"> </a><code>&nbsp&nbsp&nbsp 	 else if (event-&gt;eType == frmCloseEvent) {</code><br><a name="913355"> </a><code>&nbsp&nbsp&nbsp 	 	 frm = FrmGetActiveForm();</code><br><a name="913356"> </a><code>&nbsp&nbsp&nbsp 	 	 MyViewClose(frm);</code><br><a name="913357"> </a><code>&nbsp&nbsp&nbsp 	 	 }</code><br><a name="913358"> </a><code></code><br><a name="913359"> </a><code>&nbsp&nbsp&nbsp 	 return (handled);</code><br><a name="913360"> </a><code>&nbsp&nbsp&nbsp }</code><br><hr><br><a name="913361"> </a><h2> Summary of Standard IO</h2><p><a name="913443"> </a> </p><p><div> <table border="3"><caption><B></B></caption><tr><th colspan=2 rowspan=1><a name="913364"> </a><strong>Standard IO Macros and Functions</strong></th></tr><tr><td colspan=1 rowspan=6><a name="913371"> </a><a href="StandardIO.html#924930">fgetc</a><br><a href="StandardIO.html#924941">fgets</a><br><a href="StandardIO.html#924956">fprintf</a><br><a href="StandardIO.html#924974">fputc</a><br><a href="StandardIO.html#924986">fputs</a><br><a href="StandardIO.html#924998">getchar</a><br><a href="StandardIO.html#925007">gets</a><br><a href="StandardIO.html#925020">printf</a><br><a href="StandardIO.html#925037">putc</a></td><td colspan=1 rowspan=6><a name="913400"> </a><a href="StandardIO.html#925049">putchar</a><br><a href="StandardIO.html#925060">puts</a><br><a href="StandardIO.html#925071">SioAddCommand</a><br><a href="StandardIO.html#925237">SioMain</a><br><a href="StandardIO.html#925089">sprintf</a><br><a href="StandardIO.html#925109">system</a><br><a href="StandardIO.html#925127">vfprintf</a><br><a href="StandardIO.html#925145">vsprintf</a></td></tr><tr></tr><tr></tr><tr></tr><tr></tr><tr></tr></table><table><tr><td></table></div></p><p><a name="913489"> </a> </p><p><div> <table border="3"><caption><B></B></caption><tr><th colspan=2 rowspan=1><a name="913446"> </a><strong>Standard IO Provider Functions</strong></th></tr><tr><td colspan=1 rowspan=6><a name="913453"> </a><a href="StandardIO.html#925169">SioClearScreen</a><br><a href="StandardIO.html#925176">SioExecCommand</a><br><a href="StandardIO.html#925199">SioFree</a></td><td colspan=1 rowspan=6><a name="913464"> </a><a href="StandardIO.html#925208">SioHandleEvent</a><br><a href="StandardIO.html#925221">SioInit</a><br></td></tr><tr></tr><tr></tr><tr></tr><tr></tr><tr></tr></table><table><tr><td></table></div></p><dl><a name="913494"> </a><p></p><dt></dl><hr><br><center><B>Palm OS Programmer's Companion</B></center><br><TABLE WIDTH="100%">  <TR>    <TD WIDTH=10%>&nbsp</TD>    <TD WIDTH=20%><a href="DebuggingStrats.html"><IMG SRC="images/prev.html" BORDER=0 ALT="Previous Page"></TD>    <TD WIDTH=20%><a href="CompanionTOC.html"><IMG SRC="images/content.gif" BORDER=0 ALT="Table of Contents"></TD>    <TD WIDTH=20%><a href="CompanionIX.html"><IMG SRC="images/index.gif" BORDER=0 ALT="Index"></TD>    <TD WIDTH=20%><a href="CompanionIX.html"><IMG SRC="images/next.html" BORDER=0 ALT="Next Page"></TD>    <TD WIDTH=10%>&nbsp</TD>  </TR></TABLE><br><small><em>This is page 84 of 85 in this book</em></small><hr><br><address><a href="http://www.palmos.com/dev/">Palm Computing Platform Development Zone</a></address><i>Copyright &#169; 2000, Palm, Inc.   All rightsreserved.</i><!-- This file was created with Quadralay WebWorks Publisher 5.0.2 --><!-- --><!-- For more information on how this document, and how the rest of --><!-- this server was created, email devsupp@palm.com --><!-- --><!-- Last updated: 03/27/00 21:29:51 --></body>
<!-- Mirrored from users.fuw.edu.pl/~michalj/palmos/StandardIOApp.html by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 17 Feb 2015 19:10:17 GMT -->
</html>