<html>
<!-- Mirrored from users.fuw.edu.pl/~michalj/palmos/Beaming.html by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 17 Feb 2015 19:10:14 GMT -->
<head><title>Beaming (Infrared Communication)</title></head><body bgcolor="#ffffff"><TABLE WIDTH="100%">  <TR>    <TD WIDTH=25%><a href="SerialCommunication.html"><IMG SRC="images/prev.html" BORDER=0 ALT="Previous Page"></TD>    <TD WIDTH=25%><a href="CompanionTOC.html"><IMG SRC="images/content.gif" BORDER=0 ALT="Table of Contents"></TD>    <TD WIDTH=25%><a href="CompanionIX.html"><IMG SRC="images/index.gif" BORDER=0 ALT="Index"></TD>    <TD WIDTH=25%><a href="NetworkCommunication.html"><IMG SRC="images/next.html" BORDER=0 ALT="Next Page"></TD>  </TR></TABLE><br><center><B>Palm OS Programmer's Companion</B></center><hr><br><a name="924904"> </a><h1><IMG SRC="images/PCPplain.gif" ALT="Palm Logo" WIDTH="45" HEIGHT="44"> <a name="924902"> </a>10 Beaming (Infrared Communication)</h1><dl><a name="924906"> </a><p></p><dt>The Palm OS<sup>&#174;</sup> provides two levels of support for beaming, or infrared communication (IR):<ul type="SQUARE"><a name="924910"> </a><br><li>The <a href="Beaming.html#924917">Exchange Manager</a> provides a high-level interface that handles all of the communication details transparently. <br><a name="924914"> </a><br><li>The <a href="Beaming.html#924981">IR Library</a> provides a low-level, direct interface to the IR communications capabilities of the Palm OS. It is designed for applications that want more direct access to the IR capabilities than the exchange manager provides. <br></ul><a name="924915"> </a><p></p><dt>This chapter discusses these two facilities for IR communication.</dl><a name="924917"> </a><h2> Exchange Manager</h2><dl><a name="924919"> </a><p></p><dt>The Palm OS exchange manager provides a simple interface for Palm OS applications to send and receive typed data from any number of remote devices and protocols. The device at the remote end of a connection does not need to know it is talking to a Palm OS device. The exchange manager can be used with industry standard protocols and data formats. The burden of understanding the protocols and data formats is on the Palm OS application using the exchange manager.<a name="924920"> </a><p></p><dt>The exchange manager was developed to provide a facility by which Palm OS applications could communicate directly with external devices and foreign data formats, without having to be tied to the HotSync<sup>&#174;</sup> mechanism and conduits. In the increasingly complex world of the Internet, wireless communications, and infrared communications, it cannot be expected that all these modes of communication must support HotSync and provide the appropriate conduits on the other end. The Palm OS device must be able to deal directly with foreign data formats since there will not be conduits on the remote end to prepare the data. The data may also be sent without regard to the version or even the existence of particular software on the device.</dl><a name="924921"> </a><h3> Overview</h3><dl><a name="924922"> </a><p></p><dt>The exchange manager is designed as a generic communications facility by which typed data objects can be sent and received. It is designed to support a variety of underlying transport mechanisms. Currently, the exchange manager supports only the IR (beaming) capability of the Palm III<sup>&#153;</sup> and later devices (and upgraded PalmPilot<sup>&#153;</sup> devices).<a name="924923"> </a><blockquote><hr><strong>NOTE: &nbsp</strong><p></p>When used for IR communication, the exchange manager uses the OBEX IrDA protocol. The only level of OBEX supported currently is for the Put operation. The Palm III can act as both a client and a server.<hr><br></blockquote><a name="924934"> </a><p></p><dt>The exchange manager API provides a mechanism for exchanging typed data objects between applications. An object is a stream of bytes with some information about its contents attached. The content information includes a creator ID, a MIME data type, and a filename. An application that wants to send data using the exchange manager must provide at least one of these pieces of information. An application that is able to receive an object registers itself with the exchange manager (<code><a href="ExchangeManager.html#925320"></code>ExgRegisterData<code></a></code>) and specifies what data types and file extensions it can accept.<a name="924939"> </a><p></p><dt>A key data structure used by the exchange manager is the <code><a href="ExchangeManager.html#924968"></code>ExgSocketType<code></a></code> data type. This exchange socket structure defines information about the connection and the type of data to be exchanged. When you are sending data, you must supply this structure with the appropriate information filled in. When you are receiving, this structure gives you information about the connection and the incoming data. (Note that the use of the term "socket" in the exchange manager API is not related to the term "socket" as used in sockets communication programming.)<a name="926494"> </a><blockquote><hr><strong>NOTE: &nbsp</strong><p></p>The current implementation of the IR library does not send data type information, but it may do so in the future. It is recommended that you write information for the data type field of the socket, but do not expect to receive type information. Instead, use a filename including the extension to identify content. When registering, register for a file extension. <hr><br></blockquote></dl><a name="924943"> </a><h3> Exchange Manager and Launch Codes</h3><dl><a name="924945"> </a><p></p><dt>When receiving incoming data, the exchange manager communicates with applications via launch codes. The exchange manager sends an application a series of three launch codes when it receives data for it. These are:<ul type="SQUARE"><a name="924949"> </a><br><li><code><a href="AppLaunchCodes.html#925235"></code>sysAppLaunchCmdExgAskUser<code></a> </code><br><a name="924953"> </a><br><li><code><a href="AppLaunchCodes.html#925259"></code>sysAppLaunchCmdExgReceiveData<code></a> </code><br><a name="924957"> </a><br><li><code><a href="AppLaunchCodes.html#925328"></code>sysAppLaunchCmdGoto<code></a> </code><br></ul><a name="924958"> </a><p></p><dt>The exchange manager sends the first launch code, <code>sysAppLaunchCmdExgAskUser</code>, when it has determined that incoming data is destined for a particular application (based on which application has registered to receive data of that type). This launch code lets the application tell the exchange manager whether or not to display a dialog asking the user if they want to accept the data. If the application chooses not to handle this launch command, the default course of action is that the exchange manager displays a dialog asking the user if they want to accept the incoming data. In most cases, applications won't need to handle this launch code, since the default action is the preferred alternative.<a name="926129"> </a><p></p><dt>Palm OS 3.5 and higher provide an alternative version of the dialog that displays a category pop-up list so that users can file the incoming data at the same time it is received. The pop-up list is only displayed if you handle the launch code and call <code><a href="ExchangeManager.html#937271"></code>ExgDoDialog<code></a></code> directly. See that function's description in the <em>Palm OS SDK Reference</em> for more information. <a name="924960"> </a><p></p><dt>The application can respond to this launch code by setting the <code>result</code> field in the parameter block to the appropriate value. If it wants to allow the exchange manager to display a dialog, it should leave the <code>result</code> field set to <code>exgAskDialog</code> (the default value). To disable display of the dialog and to automatically accept the incoming data (as if the user had pressed OK in the dialog), set the <code>result</code> field to <code>exgAskOk</code>. To disable display of the dialog and to automatically reject the incoming data (as if the user had pressed Cancel in the dialog), set the <code>result</code> field to <code>exgAskCancel</code>. In the later case, the data is discarded and no further action is taken by the exchange manager.<a name="924961"> </a><p></p><dt>If the application sets the result field to <code>exgAskOk</code>, or the dialog is displayed and the user presses the OK button, then the exchange manager sends the application the next launch code, <code>sysAppLaunchCmdExgReceiveData</code>, so that it can actually receive the data. This launch code notifies the application that it should receive the data.<a name="924963"> </a><p></p><dt>The application should use the exchange manager functions <code><a href="ExchangeManager.html#941095"></code>ExgAccept<code></a></code>, <a href="ExchangeManager.html#925290">ExgReceive</a>, and <a href="ExchangeManager.html#925170">ExgDisconnect</a> to receive the data and store it or do whatever it needs to with the data.<a name="924973"> </a><p></p><dt>The parameter block sent with this launch code is of the <code>ExgSocketPtr</code> data type. It is a pointer to the <code>ExgSocketType</code> structure corresponding to the exchange manager connection via which the data is arriving. You will need to pass this pointer to the <code>ExgAccept</code> function to begin receiving the data. Note that in the socket structure, the <code>length</code> field may not be accurate, so in your receive loop you should be flexible in handling more or less data than <code>length</code> specifies.<a name="924974"> </a><p></p><dt>After you have finished receiving the data and before you return from the <code>PilotMain</code> routine, you must set up the <code>goToCreator</code> and <code>goToParams</code> fields in the socket structure. Set in the <code>goToCreator</code> field the creator ID of the application that should be launched to view the received data (normally the same application that received the data). If no application should be launched, then set this to NULL. Set in the <code>goToParams</code> structure information that identifies the record to go to when the application is launched. It is recommended that you use a unique ID to identify the record, rather than the record index, since indexes might change. You can put unique ID information into the <code>goToParams.matchCustom</code> field.<a name="924975"> </a><p></p><dt>Note that the application may not be the active application, and thus may not have globals available when it is launched with this launch code. Be sure to check if you have globals available and don't try to access them if they are not available. In addition, if the application has multiple code segments, you cannot access code outside of segment 0 (the first segment) if the application is launched with this launch code.<a name="924976"> </a><p></p><dt>Assuming that everything has proceeded normally, the exchange manager again launches the application identified in the <code>goToCreator</code> field of the socket structure with the <code>sysAppLaunchCmdGoto</code> launch code. This allows the user to view the received item.</dl><a name="924981"> </a><h2> IR Library</h2><dl><a name="924983"> </a><p></p><dt>The IR (InfraRed) library is a shared library that provides a direct interface to the IR communications capabilities of the Palm OS. It is designed for applications that want more direct access to the IR capabilities than the exchange manager provides.<a name="924984"> </a><p></p><dt>The IR support provided by the Palm OS is compliant with the IrDA specifications. IrDA (Infrared Data Association), is an industry body consisting of representatives from a number of companies involved in IR development. For a good introduction to the IrDA standards, see the IrDA web site at: <dl><a name="924985"> </a><br><code>http://www.IrDA.org.</code><br></dl></dl><a name="924986"> </a><h3> IrDA Stack</h3><dl><a name="924988"> </a><p></p><dt>The IrDA stack comprises a number of protocol layers, of which some are required and some are optional. The complete stack looks something like <a href="Beaming.html#924993">Figure 10.1</a>.</dl><a name="924993"> </a><h4>Figure 10.1	 IrDA Protocol Stack</h4><p><a name="924994"> </a></p><p><a name="925013"> </a><img src="images/Beaminga.gif" height="222" width="487"></p><dl><a name="925015"> </a><p></p><dt>The SIR/FIR layer is purely hardware. The SIR (Serial IR) layer supports speeds up to 115k bps while the FIR (Fast IR) layer supports speeds up to 4M bps. IrLAP is the IR Link Access Protocol that provides a data pipe between IrDA devices. IrLMP, the IR Link Management Protocol, manages multiple sessions using the IrLAP. Tiny TP is a lightweight transfer protocol on which some higher-level IrDA layers are built. <a name="925019"> </a><p></p><dt>One or more of SIR/FIR must be implemented, and Tiny TP, IrLMP and IrLAP must also be implemented. IrComm provides serial and parallel port emulation over an IR link and is optional (it is not currently supported in the Palm OS). IrLAN provides an access point to Local Area Network protocol adapters. It too is optional (and is not supported in the Palm OS). <a name="925021"> </a><p></p><dt>OBEX is an object exchange protocol that can be used (for instance) to transfer business cards, calendar entries or other objects between devices. It too is optional and is supported in the Palm OS. The capabilities of OBEX are made available through the exchange manager; there is no direct API for it.<a name="925022"> </a><p></p><dt>The Palm OS implements all the required protocol layers (SIR, IrLAP, IrLMP, and Tiny TP), as well as the OBEX layer, to support the Exchange Manager. Palm III devices provide SIR (Serial IR) hardware supporting the following speeds: 2400, 9600, 19200, 38400, 57600, and 115200 bps. The software (<code>IrOpen</code>) currently limits bandwidth to 57600 bps by default, but you can specify a connection speed of up to 115200 bps if desired.<a name="925023"> </a><p></p><dt>The stack is capable of connection-based or connectionless sessions.<a name="925024"> </a><p></p><dt>IrLMP Information Access Service (IAS) is a component of the IrLMP protocol that you will see mentioned in the interface. IAS provides a database service through which devices can register information about themselves and retrieve information about other devices and the services they offer.</dl><a name="925025"> </a><h3> Accessing the IR Library</h3><dl><a name="925026"> </a><p></p><dt>Before you can use the IR library, you must obtain a reference number for it by calling the function <code><a href="SystemManager.html#925491"></code>SysLibFind<code></a></code>, as in this example:<dl><a name="925031"> </a><br><code>err = SysLibFind(irLibName, &amp;refNum);</code><br><dl><a name="925032"> </a><p></p><dt>This function returns the library reference number in the <code>refNum</code> parameter. This parameter is passed to most of the other functions in the IR library.</dl></dl></dl><a name="925033"> </a><h2> Summary of Beaming</h2><p><a name="925079"> </a> </p><p><div> <table border="3"><caption><B></B></caption><tr><th colspan=2 rowspan=1><a name="925036"> </a><strong>Exchange Manager Functions</strong></th></tr><tr><td><a name="925043"> </a><a href="ExchangeManager.html#941095">ExgAccept</a></td><td><a name="925048"> </a><a href="ExchangeManager.html#925246">ExgPut</a></td></tr><tr><td><a name="925053"> </a><a href="ExchangeManager.html#925101">ExgDBRead</a></td><td><a name="925058"> </a><a href="ExchangeManager.html#925290">ExgReceive</a></td></tr><tr><td><a name="925063"> </a><a href="ExchangeManager.html#925138">ExgDBWrite</a></td><td><a name="925068"> </a><a href="ExchangeManager.html#925320">ExgRegisterData</a></td></tr><tr><td><a name="925073"> </a><a href="ExchangeManager.html#925170">ExgDisconnect</a></td><td><a name="925078"> </a><a href="ExchangeManager.html#925348">ExgSend</a></td></tr><tr><td><a name="926119"> </a><a href="ExchangeManager.html#937271">ExgDoDialog</a> </td><td><a name="926121"> </a></td></tr></table><table><tr><td></table></div></p><p><a name="925195"> </a> </p><p><div> <table border="3"><caption><B></B></caption><tr><th colspan=2 rowspan=1><a name="925082"> </a><strong>IR Library Functions</strong></th></tr><tr><td><a name="925089"> </a><a href="IRLib.html#925273">IrAdvanceCredit</a> </td><td><a name="925094"> </a><a href="IRLib.html#925541">IrIsNoProgress</a> </td></tr><tr><td><a name="925099"> </a><a href="IRLib.html#925295">IrBind</a> </td><td><a name="925104"> </a><a href="IRLib.html#925557">IrIsRemoteBusy</a> </td></tr><tr><td><a name="925109"> </a><a href="IRLib.html#925321">IrClose</a> </td><td><a name="925114"> </a><a href="IRLib.html#925573">IrLocalBusy</a> </td></tr><tr><td><a name="925119"> </a><a href="IRLib.html#925338">IrConnectIrLap</a> </td><td><a name="925124"> </a><a href="IRLib.html#925594">IrMaxRxSize</a> </td></tr><tr><td><a name="925129"> </a><a href="IRLib.html#925361">IrConnectReq</a> </td><td><a name="925134"> </a><a href="IRLib.html#925614">IrMaxTxSize</a> </td></tr><tr><td><a name="925139"> </a><a href="IRLib.html#925393">IrConnectRsp</a> </td><td><a name="925144"> </a><a href="IRLib.html#925634">IrOpen</a> </td></tr><tr><td><a name="925149"> </a><a href="IRLib.html#925425">IrDataReq</a> </td><td><a name="925154"> </a><a href="IRLib.html#925670">IrSetConTypeLMP</a> </td></tr><tr><td><a name="925159"> </a><a href="IRLib.html#925461">IrDisconnectIrLap</a> </td><td><a name="925164"> </a><a href="IRLib.html#925689">IrSetConTypeTTP</a> </td></tr><tr><td><a name="925169"> </a><a href="IRLib.html#925480">IrDiscoverReq</a> </td><td><a name="925174"> </a><a href="IRLib.html#925708">IrSetDeviceInfo</a> </td></tr><tr><td><a name="925179"> </a><a href="IRLib.html#925507">IrIsIrLapConnected</a> </td><td><a name="925184"> </a><a href="IRLib.html#925729">IrTestReq</a> </td></tr><tr><td><a name="925189"> </a><a href="IRLib.html#925525">IrIsMediaBusy</a> </td><td><a name="925194"> </a><a href="IRLib.html#925760">IrUnbind</a> </td></tr></table><table><tr><td></table></div></p><p><a name="925271"> </a> </p><p><div> <table border="3"><caption><B></B></caption><tr><th colspan=2 rowspan=1><a name="925198"> </a><strong>IR Library IAS Database Functions</strong></th></tr><tr><td><a name="925205"> </a><a href="IRLib.html#925842">IrIAS_Add</a> </td><td><a name="925210"> </a><a href="IRLib.html#925995">IrIAS_GetUserString</a> </td></tr><tr><td><a name="925215"> </a><a href="IRLib.html#925869">IrIAS_GetInteger</a> </td><td><a name="925220"> </a><a href="IRLib.html#926017">IrIAS_GetUserStringCharSet</a></td></tr><tr><td><a name="925225"> </a><a href="IRLib.html#925891">IrIAS_GetIntLsap</a> </td><td><a name="925230"> </a><a href="IRLib.html#926039">IrIAS_GetUserStringLen</a> </td></tr><tr><td><a name="925235"> </a><a href="IRLib.html#925913">IrIAS_GetObjectID</a> </td><td><a name="925240"> </a><a href="IRLib.html#926061">IrIAS_Next</a> </td></tr><tr><td><a name="925245"> </a><a href="IRLib.html#925932">IrIAS_GetOctetString</a> </td><td><a name="925250"> </a><a href="IRLib.html#926083">IrIAS_Query</a> </td></tr><tr><td><a name="925255"> </a><a href="IRLib.html#925954">IrIAS_GetOctetStringLen</a> </td><td><a name="925260"> </a><a href="IRLib.html#926118">IrIAS_SetDeviceName</a> </td></tr><tr><td><a name="925265"> </a><a href="IRLib.html#925976">IrIAS_GetType</a> </td><td><a name="925270"> </a><a href="IRLib.html#926137">IrIAS_StartResult</a> </td></tr></table><table><tr><td></table></div></p><p><a name="925305"> </a> <strong></strong></p><hr><br><center><B>Palm OS Programmer's Companion</B></center><br><TABLE WIDTH="100%">  <TR>    <TD WIDTH=10%>&nbsp</TD>    <TD WIDTH=20%><a href="SerialCommunication.html"><IMG SRC="images/prev.html" BORDER=0 ALT="Previous Page"></TD>    <TD WIDTH=20%><a href="CompanionTOC.html"><IMG SRC="images/content.gif" BORDER=0 ALT="Table of Contents"></TD>    <TD WIDTH=20%><a href="CompanionIX.html"><IMG SRC="images/index.gif" BORDER=0 ALT="Index"></TD>    <TD WIDTH=20%><a href="NetworkCommunication.html"><IMG SRC="images/next.html" BORDER=0 ALT="Next Page"></TD>    <TD WIDTH=10%>&nbsp</TD>  </TR></TABLE><br><small><em>This is page 79 of 85 in this book</em></small><hr><br><address><a href="http://www.palmos.com/dev/">Palm Computing Platform Development Zone</a></address><i>Copyright &#169; 2000, Palm, Inc.   All rightsreserved.</i><!-- This file was created with Quadralay WebWorks Publisher 5.0.2 --><!-- --><!-- For more information on how this document, and how the rest of --><!-- this server was created, email devsupp@palm.com --><!-- --><!-- Last updated: 03/27/00 21:29:46 --></body>
<!-- Mirrored from users.fuw.edu.pl/~michalj/palmos/Beaming.html by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 17 Feb 2015 19:10:16 GMT -->
</html>