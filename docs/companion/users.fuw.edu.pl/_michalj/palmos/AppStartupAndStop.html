<html>
<!-- Mirrored from users.fuw.edu.pl/~michalj/palmos/AppStartupAndStop.html by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 17 Feb 2015 19:10:04 GMT -->
<head><title>Application Startup and Stop</title></head><body bgcolor="#ffffff"><TABLE WIDTH="100%">  <TR>    <TD WIDTH=25%><a href="Design.html"><IMG SRC="images/prev.html" BORDER=0 ALT="Previous Page"></TD>    <TD WIDTH=25%><a href="CompanionTOC.html"><IMG SRC="images/content.gif" BORDER=0 ALT="Table of Contents"></TD>    <TD WIDTH=25%><a href="CompanionIX.html"><IMG SRC="images/index.gif" BORDER=0 ALT="Index"></TD>    <TD WIDTH=25%><a href="EventLoop.html"><IMG SRC="images/next.html" BORDER=0 ALT="Next Page"></TD>  </TR></TABLE><br><center><B>Palm OS Programmer's Companion</B></center><hr><br><a name="924904"> </a><h1><IMG SRC="images/PCPplain.gif" ALT="Palm Logo" WIDTH="45" HEIGHT="44"> <a name="924902"> </a>3	 	 	 	 	 	 	 	  Application Startup and Stop</h1><dl><a name="924907"> </a><p></p><dt>This chapter describes how an application launches, how an application stops, and the code you must write to perform these tasks properly. It covers: <ul type="SQUARE"><a name="924911"> </a><br><li><a href="AppStartupAndStop.html#924937">Launch Codes and Launching an Application</a><br><a name="924915"> </a><br><li><a href="AppStartupAndStop.html#924957">Responding to Launch Codes</a><br><a name="924919"> </a><br><li><a href="AppStartupAndStop.html#925179">Launching Applications Programmatically</a><br><a name="924923"> </a><br><li><a href="AppStartupAndStop.html#925244">Creating Your Own Launch Codes</a><br><a name="924927"> </a><br><li><a href="AppStartupAndStop.html#925252">Stopping an Application</a><br><a name="924931"> </a><br><li><a href="AppStartupAndStop.html#925294">Launch Code Summary</a><br></ul><a name="924932"> </a><p></p><dt>This chapter does not cover the main application event loop. The event loop is covered in <a href="EventLoop.html#924905">Chapter 4, "Event Loop."</a></dl><a name="924937"> </a><h2> Launch Codes and Launching an Application</h2><dl><a name="924939"> </a><p></p><dt>An application launches when it receives a <em>launch code</em>. Launch codes are a means of communication between the Palm OS and the application (or between two applications). <a name="924940"> </a><p></p><dt>For example, an application typically launches when a user presses one of the buttons on the device or selects an application icon from the application launcher screen. When this happens, the system generates the launch code <code>sysAppLaunchCmdNormalLaunch</code>, which tells the application to perform a full launch and display its user interface. <a name="924943"> </a><p></p><dt>Other launch codes specify that the application should perform some action but not necessarily become the current application (the application the user sees). A good example of this is the launch code used by the global find facility. The global find facility allows users to search all databases for a certain record, such as a name. In this case, it would be very wasteful to do a full launch--including the user interface--of each application only to access the application's databases in search of that item. Using a launch code avoids this overhead.<a name="924944"> </a><p></p><dt>Each launch code may be accompanied by two types of information:<ul type="SQUARE"><a name="924946"> </a><br><li>A parameter block, a pointer to a structure that contains several parameters. These parameters contain information necessary to handle the associated launch code. <br><a name="924948"> </a><br><li>Launch flags indicate how the application should behave. For example, a flag could be used to specify whether the application should display UI or not. (See <a href="AppLaunchCodes.html#925514">"Launch Flags"</a> in the <em>Palm OS SDK Reference</em>.) <br></ul><a name="924952"> </a><p></p><dt>A complete list of all launch codes is provided at the end of this chapter in the section "<a href="AppStartupAndStop.html#925294">Launch Code Summary</a>." That section contains links into where each launch code is described in the <em>Palm OS SDK Reference</em>. </dl><a name="924957"> </a><h2> Responding to Launch Codes</h2><dl><a name="924958"> </a><p></p><dt>Your application should respond to launch codes in a function named <code>PilotMain</code>. <code>PilotMain</code> is the entry point for all applications. <a name="924960"> </a><p></p><dt>When an application receives a launch code, it must first check whether it can handle this particular code. For example, only applications that have text data should respond to a launch code requesting a string search. If an application can't handle a launch code, it exits without failure. Otherwise, it performs the action immediately and returns. <a name="924964"> </a><p></p><dt><a href="AppStartupAndStop.html#924967">Listing 3.1</a> shows parts of <code>PilotMain</code> from the Datebook application as an example. To see the complete example, go to the examples folder in the Palm OS SDK and look at the file <code>Datebook.c</code>. </dl><a name="924967"> </a><h4>Listing 3.1	 PilotMain in Datebook.c</h4><a name="924968"> </a><hr><code>UInt32 PilotMain (UInt16&nbsp;cmd, void&nbsp;*cmdPBP, UInt16&nbsp;launchFlags)</code><br><a name="924969"> </a><code>{</code><br><a name="924970"> </a><code>&nbsp&nbsp&nbsp return DBPilotMain(cmd, cmdPBP, launchFlags);</code><br><a name="924971"> </a><code>}<br></code><br><a name="924972"> </a><code>static UInt32 DBPilotMain (UInt16&nbsp;cmd, void&nbsp;*cmdPBP, UInt16&nbsp;launchFlags)</code><br><a name="924973"> </a><code>{</code><br><a name="924974"> </a><code>&nbsp&nbsp&nbsp UInt16 error;</code><br><a name="924975"> </a><code>&nbsp&nbsp&nbsp Boolean launched;</code><br><a name="924976"> </a><code></code><br><a name="924977"> </a><code>&nbsp&nbsp&nbsp // This app makes use of PalmOS 2.0 features.It will crash if </code><br><a name="924978"> </a><code>&nbsp&nbsp&nbsp // run on an earlier version of PalmOS. Detect and warn if this </code><br><a name="924979"> </a><code>&nbsp&nbsp&nbsp // happens, then exit.</code><br><a name="924980"> </a><code>&nbsp&nbsp&nbsp error = RomVersionCompatible (version20, launchFlags);</code><br><a name="924981"> </a><code>&nbsp&nbsp&nbsp if (error)</code><br><a name="924982"> </a><code>&nbsp&nbsp&nbsp 	 return error;</code><br><a name="924983"> </a><code></code><br><a name="924984"> </a><code>&nbsp&nbsp&nbsp // Launch code sent by the launcher or the datebook button.</code><br><a name="924985"> </a><code>&nbsp&nbsp&nbsp if (cmd == sysAppLaunchCmdNormalLaunch)</code><br><a name="924986"> </a><code>&nbsp&nbsp&nbsp 	 {</code><br><a name="924987"> </a><code>&nbsp&nbsp&nbsp 	 error = StartApplication ();</code><br><a name="924988"> </a><code>&nbsp&nbsp&nbsp 	 if (error) return (error);</code><br><a name="924989"> </a><code></code><br><a name="924990"> </a><code>&nbsp&nbsp&nbsp 	 FrmGotoForm (DayView);</code><br><a name="924991"> </a><code>&nbsp&nbsp&nbsp 	 EventLoop ();</code><br><a name="924992"> </a><code>&nbsp&nbsp&nbsp 	 StopApplication ();</code><br><a name="924993"> </a><code>&nbsp&nbsp&nbsp 	 }</code><br><a name="924994"> </a><code>&nbsp&nbsp&nbsp </code><br><a name="924995"> </a><code></code><br><a name="924996"> </a><code>&nbsp&nbsp&nbsp // Launch code sent by text search.</code><br><a name="924997"> </a><code>&nbsp&nbsp&nbsp else if (cmd == sysAppLaunchCmdFind)</code><br><a name="924998"> </a><code>&nbsp&nbsp&nbsp 	 {</code><br><a name="924999"> </a><code>&nbsp&nbsp&nbsp 	 Search ((FindParamsPtr)cmdPBP);</code><br><a name="925000"> </a><code>&nbsp&nbsp&nbsp 	 }</code><br><a name="925001"> </a><code>&nbsp&nbsp&nbsp </code><br><a name="925002"> </a><code></code><br><a name="925003"> </a><code>&nbsp&nbsp&nbsp // This launch code might be sent to the app when it's already </code><br><a name="925004"> </a><code>&nbsp&nbsp&nbsp // running if the user hits the "Go To" button in the Find </code><br><a name="925005"> </a><code>&nbsp&nbsp&nbsp // Results dialog box.</code><br><a name="925006"> </a><code>&nbsp&nbsp&nbsp else if (cmd == sysAppLaunchCmdGoTo)</code><br><a name="925007"> </a><code>&nbsp&nbsp&nbsp 	 {</code><br><a name="925008"> </a><code>&nbsp&nbsp&nbsp 	 launched = launchFlags &amp; sysAppLaunchFlagNewGlobals;</code><br><a name="925009"> </a><code>&nbsp&nbsp&nbsp 	 if (launched)</code><br><a name="925010"> </a><code>&nbsp&nbsp&nbsp 	 	 {</code><br><a name="925011"> </a><code>&nbsp&nbsp&nbsp 	 	 error = StartApplication ();</code><br><a name="925012"> </a><code>&nbsp&nbsp&nbsp 	 	 if (error) return (error);</code><br><a name="925013"> </a><code></code><br><a name="925014"> </a><code>&nbsp&nbsp&nbsp 	 	 GoToItem ((GoToParamsPtr) cmdPBP, launched);</code><br><a name="925015"> </a><code></code><br><a name="925016"> </a><code>&nbsp&nbsp&nbsp 	 	 EventLoop ();</code><br><a name="925017"> </a><code>&nbsp&nbsp&nbsp 	 	 StopApplication ();	 </code><br><a name="925018"> </a><code>&nbsp&nbsp&nbsp 	 	 }</code><br><a name="925019"> </a><code>&nbsp&nbsp&nbsp 	 else</code><br><a name="925020"> </a><code>&nbsp&nbsp&nbsp 	 	 GoToItem ((GoToParamsPtr) cmdPBP, launched);</code><br><a name="925021"> </a><code>&nbsp&nbsp&nbsp 	 }</code><br><a name="925022"> </a><code></code><br><a name="925023"> </a><code>&nbsp&nbsp&nbsp // Launch code sent by sync application to notify the datebook </code><br><a name="925024"> </a><code>&nbsp&nbsp&nbsp // application that its database was been synced.</code><br><a name="925025"> </a><code>&nbsp&nbsp&nbsp // ...</code><br><a name="925026"> </a><code>&nbsp&nbsp&nbsp // Launch code sent by Alarm Manager to notify the datebook </code><br><a name="925027"> </a><code>&nbsp&nbsp&nbsp // application that an alarm has triggered.</code><br><a name="925028"> </a><code>&nbsp&nbsp&nbsp // ...</code><br><a name="925029"> </a><code>&nbsp&nbsp&nbsp // Launch code sent by Alarm Manager to notify the datebook </code><br><a name="925030"> </a><code>&nbsp&nbsp&nbsp // application that is should display its alarm dialog.</code><br><a name="925031"> </a><code>&nbsp&nbsp&nbsp // ...</code><br><a name="925032"> </a><code>&nbsp&nbsp&nbsp // Launch code sent when the system time is changed.</code><br><a name="925033"> </a><code>&nbsp&nbsp&nbsp // ...</code><br><a name="925034"> </a><code>&nbsp&nbsp&nbsp // Launch code sent after the system is reset. We use this time</code><br><a name="925035"> </a><code>&nbsp&nbsp&nbsp // to create our default database if this is a hard reset</code><br><a name="925036"> </a><code>&nbsp&nbsp&nbsp // ...</code><br><a name="925037"> </a><code>&nbsp&nbsp&nbsp // Launch code sent by the DesktopLink server when it create </code><br><a name="925038"> </a><code>&nbsp&nbsp&nbsp // a new database.  We will initialize the new database.</code><br><a name="925039"> </a><code>&nbsp&nbsp&nbsp return (0);</code><br><a name="925040"> </a><code>}</code><br><hr><br><a name="925042"> </a><h3> Responding to Normal Launch</h3><dl><a name="925043"> </a><p></p><dt>When an application receives the launch code <code>sysAppLaunchCmdNormalLaunch</code>, it begins with a startup routine, then goes into an event loop, and finally exits with a stop routine. (The event loop is described in <a href="EventLoop.html#924905">Chapter 4, "Event Loop."</a> The stop routine is shown in the section "<a href="AppStartupAndStop.html#925252">Stopping an Application</a>" at the end of this chapter.) <a name="925052"> </a><p></p><dt>During the startup routine, your application should perform these actions: </dl>  <a name="925054"> </a><font face="">Get system-wide preferences (for example for numeric or date and time formats) and use them to initialize global variables that will be referenced throughout the application. </font>  <a name="925055"> </a><font face="">Find the application database by creator type. If none exists, create it and initialize it. </font>  <a name="925057"> </a><font face="">Get application-specific preferences and initialize related global variables. </font>  <a name="925059"> </a><font face="">Initialize any other global variables.</font><dl><a name="925063"> </a><p></p><dt>As you saw in <a href="AppStartupAndStop.html#924967">Listing 3.1</a>, the Datebook application example responds to <code>sysAppLaunchCmdNormalLaunch</code> by calling a function named <code>StartApplication</code>. <a href="AppStartupAndStop.html#925068">Listing 3.2</a> shows the <code>StartApplication</code> function. </dl><a name="925068"> </a><h4>Listing 3.2	 StartApplication from Datebook.c</h4><a name="925069"> </a><hr><code>static UInt16 StartApplication (void)</code><br><a name="925070"> </a><code>{</code><br><a name="925071"> </a><code>&nbsp&nbsp&nbsp UInt16 error = 0;</code><br><a name="925072"> </a><code>&nbsp&nbsp&nbsp Err err = 0;</code><br><a name="925073"> </a><code>&nbsp&nbsp&nbsp UInt16 mode;</code><br><a name="925074"> </a><code>&nbsp&nbsp&nbsp DateTimeType dateTime;</code><br><a name="925075"> </a><code>&nbsp&nbsp&nbsp DatebookPreferenceType prefs;</code><br><a name="925076"> </a><code>&nbsp&nbsp&nbsp SystemPreferencesType sysPrefs;</code><br><a name="925077"> </a><code>&nbsp&nbsp&nbsp UInt16 prefsSize;</code><br><a name="925078"> </a><code></code><br><a name="925079"> </a><code>&nbsp&nbsp&nbsp // Step 1: Get system-wide preferences. </code><br><a name="925080"> </a><code>&nbsp&nbsp&nbsp PrefGetPreferences (&amp;sysPrefs);</code><br><a name="925081"> </a><code>&nbsp&nbsp&nbsp // Determime if secret records should be displayed.</code><br><a name="925082"> </a><code>&nbsp&nbsp&nbsp HideSecretRecords = sysPrefs.hideSecretRecords;</code><br><a name="925083"> </a><code>&nbsp&nbsp&nbsp </code><br><a name="925084"> </a><code>&nbsp&nbsp&nbsp if (HideSecretRecords)</code><br><a name="925085"> </a><code>&nbsp&nbsp&nbsp 	 mode = dmModeReadWrite;</code><br><a name="925086"> </a><code>&nbsp&nbsp&nbsp else</code><br><a name="925087"> </a><code>&nbsp&nbsp&nbsp 	 mode = dmModeReadWrite | dmModeShowSecret;</code><br><a name="925088"> </a><code></code><br><a name="925089"> </a><code>&nbsp&nbsp&nbsp // Get the time formats from the system preferences.</code><br><a name="925090"> </a><code>&nbsp&nbsp&nbsp TimeFormat = sysPrefs.timeFormat;</code><br><a name="925091"> </a><code></code><br><a name="925092"> </a><code>&nbsp&nbsp&nbsp // Get the date formats from the system preferences.</code><br><a name="925093"> </a><code>&nbsp&nbsp&nbsp LongDateFormat = sysPrefs.longDateFormat;</code><br><a name="925094"> </a><code>&nbsp&nbsp&nbsp ShortDateFormat = sysPrefs.dateFormat;</code><br><a name="925095"> </a><code></code><br><a name="925096"> </a><code>&nbsp&nbsp&nbsp // Get the starting day of the week from the </code><br><a name="925097"> </a><code>&nbsp&nbsp&nbsp // system preferences.</code><br><a name="925098"> </a><code>&nbsp&nbsp&nbsp StartDayOfWeek = sysPrefs.weekStartDay;</code><br><a name="925099"> </a><code>&nbsp&nbsp&nbsp </code><br><a name="925100"> </a><code></code><br><a name="925101"> </a><code>&nbsp&nbsp&nbsp // Get today's date.</code><br><a name="925102"> </a><code>&nbsp&nbsp&nbsp TimSecondsToDateTime (TimGetSeconds (), &amp;dateTime);</code><br><a name="925103"> </a><code>&nbsp&nbsp&nbsp Date.year = dateTime.year - firstYear;</code><br><a name="925104"> </a><code>&nbsp&nbsp&nbsp Date.month = dateTime.month;</code><br><a name="925105"> </a><code>&nbsp&nbsp&nbsp Date.day = dateTime.day;</code><br><a name="925106"> </a><code></code><br><a name="925107"> </a><code></code><br><a name="925108"> </a><code>&nbsp&nbsp&nbsp // Step 2. Find the application's data file.  If it doesn't <br>	 // exist, create it.</code><br><a name="925109"> </a><code>&nbsp&nbsp&nbsp ApptDB = DmOpenDatabaseByTypeCreator(datebookDBType, <br>	 	 	 	 	 	 	 sysFileCDatebook, mode);</code><br><a name="925110"> </a><code>&nbsp&nbsp&nbsp if (! ApptDB)</code><br><a name="925111"> </a><code>&nbsp&nbsp&nbsp 	 {</code><br><a name="925112"> </a><code>&nbsp&nbsp&nbsp 	 error = DmCreateDatabase (0, datebookDBName, sysFileCDatebook,</code><br><a name="925113"> </a><code>&nbsp&nbsp&nbsp 	 	 	 	 	 	 	 datebookDBType, false);</code><br><a name="925114"> </a><code>&nbsp&nbsp&nbsp 	 if (error) return error;</code><br><a name="925115"> </a><code>&nbsp&nbsp&nbsp 	 </code><br><a name="925116"> </a><code>&nbsp&nbsp&nbsp 	 ApptDB = DmOpenDatabaseByTypeCreator(datebookDBType, <br>	 	 	 	 	 	 	 	 sysFileCDatebook, mode);</code><br><a name="925117"> </a><code>&nbsp&nbsp&nbsp 	 if (! ApptDB) return (1);</code><br><a name="925118"> </a><code></code><br><a name="925119"> </a><code>&nbsp&nbsp&nbsp 	 error = ApptAppInfoInit (ApptDB);</code><br><a name="925120"> </a><code>&nbsp&nbsp&nbsp 	 if (error) return error;</code><br><a name="925121"> </a><code>&nbsp&nbsp&nbsp 	 }</code><br><a name="925122"> </a><code>&nbsp&nbsp&nbsp </code><br><a name="925123"> </a><code></code><br><a name="925124"> </a><code>&nbsp&nbsp&nbsp // Step 3. Get application-specific preferences. </code><br><a name="925125"> </a><code>&nbsp&nbsp&nbsp // Read the preferences / saved-state information.  There is </code><br><a name="925126"> </a><code>&nbsp&nbsp&nbsp // only one version of the DateBook preferences so don't worry </code><br><a name="925127"> </a><code>&nbsp&nbsp&nbsp // about multiple versions.</code><br><a name="925128"> </a><code>&nbsp&nbsp&nbsp prefsSize = sizeof (DatebookPreferenceType);</code><br><a name="925129"> </a><code>&nbsp&nbsp&nbsp if (PrefGetAppPreferences (sysFileCDatebook, datebookPrefID, <br>	 	 	 	 	 	 	 	 	 	 	 	 	 	 &amp;prefs, &amp;prefsSize, </code><br><a name="925130"> </a><code>&nbsp&nbsp&nbsp 	 true) != noPreferenceFound)</code><br><a name="925131"> </a><code>&nbsp&nbsp&nbsp 	 {</code><br><a name="925132"> </a><code>&nbsp&nbsp&nbsp 	 DayStartHour = prefs.dayStartHour;</code><br><a name="925133"> </a><code>&nbsp&nbsp&nbsp 	 DayEndHour = prefs.dayEndHour;</code><br><a name="925134"> </a><code>&nbsp&nbsp&nbsp 	 AlarmPreset = prefs.alarmPreset;</code><br><a name="925135"> </a><code>&nbsp&nbsp&nbsp 	 NoteFont = prefs.noteFont;</code><br><a name="925136"> </a><code>&nbsp&nbsp&nbsp 	 SaveBackup = prefs.saveBackup;</code><br><a name="925137"> </a><code>&nbsp&nbsp&nbsp 	 ShowTimeBars = prefs.showTimeBars;</code><br><a name="925138"> </a><code>&nbsp&nbsp&nbsp 	 CompressDayView = prefs.compressDayView;</code><br><a name="925139"> </a><code>&nbsp&nbsp&nbsp 	 ShowTimedAppts = prefs.showTimedAppts;</code><br><a name="925140"> </a><code>&nbsp&nbsp&nbsp 	 ShowUntimedAppts = prefs.showUntimedAppts;</code><br><a name="925141"> </a><code>&nbsp&nbsp&nbsp 	 ShowDailyRepeatingAppts = prefs.showDailyRepeatingAppts;</code><br><a name="925142"> </a><code>&nbsp&nbsp&nbsp 	 }</code><br><a name="925143"> </a><code></code><br><a name="925144"> </a><code>&nbsp&nbsp&nbsp // Step 4. Initialize any other global variables. </code><br><a name="925145"> </a><code>&nbsp&nbsp&nbsp TopVisibleAppt = 0;</code><br><a name="925146"> </a><code>&nbsp&nbsp&nbsp CurrentRecord = noRecordSelected;	 </code><br><a name="925147"> </a><code>&nbsp&nbsp&nbsp </code><br><a name="925148"> </a><code></code><br><a name="925149"> </a><code>&nbsp&nbsp&nbsp // Load the far call jump table.</code><br><a name="925150"> </a><code>&nbsp&nbsp&nbsp FarCalls.apptGetAppointments = ApptGetAppointments;</code><br><a name="925151"> </a><code>&nbsp&nbsp&nbsp FarCalls.apptGetRecord = ApptGetRecord;</code><br><a name="925152"> </a><code>&nbsp&nbsp&nbsp FarCalls.apptFindFirst = ApptFindFirst;</code><br><a name="925153"> </a><code>&nbsp&nbsp&nbsp FarCalls.apptNextRepeat = ApptNextRepeat;</code><br><a name="925154"> </a><code>&nbsp&nbsp&nbsp FarCalls.apptNewRecord = ApptNewRecord;</code><br><a name="925155"> </a><code>&nbsp&nbsp&nbsp FarCalls.moveEvent = MoveEvent;</code><br><a name="925156"> </a><code></code><br><a name="925157"> </a><code>&nbsp&nbsp&nbsp return (error);</code><br><a name="925158"> </a><code>}</code><br><hr><br><a name="925159"> </a><h3> Responding to Other Launch Codes</h3><dl><a name="925160"> </a><p></p><dt>If an application receives a launch code other than <code>sysAppLaunchCmdNormalLaunch</code>, it decides if it should respond to that launch code. If it responds to the launch code, it does so by implementing a launch code handler, which is invoked from its <code>PilotMain</code> function. <a name="925161"> </a><p></p><dt>In most cases, when you respond to other launch codes, you are not able to access global variables. Global variables are generally only allocated after an application receives <code>sysAppLaunchCmdNormalLaunch</code> (see <a href="AppStartupAndStop.html#925068">Listing 3.2</a>) or <code><a href="AppLaunchCodes.html#925328"></code>sysAppLaunchCmdGoto<code></a></code>; so if the application hasn't received either of these launch codes, its global variables are usually not allocated and not accessible. In addition, if the application has multiple code segments, you cannot access code outside of segment 0 (the first segment) if the application has no access to global variables.<a name="925168"> </a><p></p><dt>There is one other case where an application may have access to its global variables (and to code segments other than 0). This is when an application is launched with the code <code><a href="AppLaunchCodes.html#925501"></code>sysAppLaunchCmdURLParams<code></a></code>. If this launch code results from a <code>palm</code> URL, then globals are available. If the launch code results from a <code>palmcall</code> URL, then globals are not available. The URL is passed to your application in the launch parameter block.<a name="925172"> </a><blockquote><hr><strong>NOTE: &nbsp</strong><p></p>Static local variables are stored with the global variables on the system's dynamic heap. They are not accessible if global variables are not accessible.<hr><br></blockquote><a name="925173"> </a><p></p><dt>Checking launch codes is generally a good way to determine if your application has access to global variables. However, it actually depends on the setting of the launch flags that are sent with the launch code. In particular, if the <code>sysAppLaunchFlagNewGlobals</code> flag is set, then your application's global variables have been allocated on this launch. This flag is set by the system and isn't (and shouldn't be) set by the sender of a launch code.</dl><a name="925174"> </a><hr><code>Boolean appHasGlobals = launchFlags &amp; sysAppLaunchFlag<code>NewGlobals</code>;</code><br><hr><br><dl><a name="925175"> </a><p></p><dt>There's one case where this flag won't be set and your application will still have access to global variables. This is when your application is already running as the current application. In this case, its global variables have already been allocated through a previous launch.<a name="925176"> </a><p></p><dt>If your application receives a launch code other than <code>sysAppLaunchCmdNormalLaunch</code> or <code>sysAppLaunchCmdGoTo</code>, you can find out if it is the current application by checking the launch flags that are sent with the launch code. If the application is the currently running application, the <code>sysAppLaunchFlagSubCall</code> flag is set. This flag is set by the system and isn't (and shouldn't be) set by the sender of a launch code. </dl><a name="925177"> </a><hr><code>Boolean appIsActive = launchFlags &amp; sysAppLaunchFlagSubCall;</code><br><hr><br><a name="925179"> </a><h2> Launching Applications Programmatically</h2><dl><a name="925181"> </a><p></p><dt>Applications can send launch codes to each other, so your application might be launched from another application or it might be launched from the system. An application can use a launch code to request that another application perform an action or modify its data. For example, a data collection application could instruct an email application to queue up a particular message to be sent.<a name="925182"> </a><p></p><dt>Sending a launch code to another application is like calling a specific subroutine in that application: the application responding to the launch code is responsible for determining what to do given the launch code constant passed on the stack as a parameter. <a name="925183"> </a><p></p><dt>To send a launch code to another application, use the System Manager function <a href="SystemManager.html#924917">SysAppLaunch</a>. Use this routine when you want to make use of another application's functionality and eventually return control of the system to your application. Usually, applications use it only for sending launch codes to other user-interface applications. <a name="925191"> </a><p></p><dt><a href="SystemManager.html#924917">SysAppLaunch</a> has numerous options, including whether to launch the application as a separate task, whether to allocate a globals world, and whether or not to give the called application its own stack. For example, you would use this function to request that the built in Address List application search its databases for a specified phone number and return the results of the search to your application. You could then call <a href="SystemManager.html#924917">SysAppLaunch</a> again to use the modem handle to dial the number. (In fact, this is how the built-in applications perform this task.) When calling <a href="SystemManager.html#924917">SysAppLaunch</a> do not set launch flags yourself--the <a href="SystemManager.html#924917">SysAppLaunch</a> function sets launch flags appropriately for you. <a name="925203"> </a><p></p><dt>An alternative, simpler method of sending launch codes is the <a href="SystemManager.html#925101">SysBroadcastActionCode</a> call. This routine automatically finds all other user-interface applications and calls <a href="SystemManager.html#924917">SysAppLaunch</a> to send the launch code to each of them.<a name="925211"> </a><p></p><dt>If your application is called to process a launch code, it is called as a subroutine from the current user-interface application. Use the routine <a href="SystemManager.html#925175">SysCurAppDatabase</a> to get the card number and database ID of your application (not of the user-interface application that launched your application).<a name="925217"> </a><p></p><dt>If you want to actually close your application and open another application, use <a href="SystemManager.html#925699">SysUIAppSwitch</a> instead of <code>SysAppLaunch</code>. This routine notifies the system which application to launch next and feeds an application-quit event into the event queue. If and when the current application responds to the quit event and returns, the system launches the new application.<a name="925222"> </a><p></p><dt>When you allocate a parameter block to pass to <code>SysUIAppSwitch</code> or <code>SysAppLaunch</code>, you must call <code><a href="MemoryManager.html#925698"></code>MemPtrSetOwner<code></a></code> to grant ownership of the parameter block chunk to the OS (your application is originally set as the owner). If the parameter block structure contains references by pointer or handle to any other chunks, you also must set the owner of those chunks by calling <code>MemPtrSetOwner</code> or <code><a href="MemoryManager.html#955510"></code>MemHandleSetOwner<code></a></code>. If you don't change the ownership of the parameter block, it will get freed before the application you're launching has a chance to use it.<a name="925229"> </a><p></p><dt>In Palm OS 3.0 and higher, you can also use the Application Launcher to launch any application. For more information, see the section <a href="UserInterface.html#926561">"Application Launcher"</a> in the <a href="UserInterface.html#924904">"User Interface"</a> chapter. <a name="925239"> </a><blockquote><hr><em><strong>WARNING!</strong></em><p></p>Do not use the <a href="SystemManager.html#925699">SysUIAppSwitch</a> or <a href="SystemManager.html#924917">SysAppLaunch</a> functions to open the Application Launcher application. <hr><br></blockquote></dl><a name="925244"> </a><h2> Creating Your Own Launch Codes </h2><dl><a name="925246"> </a><p></p><dt>The Palm OS contains predefined launch codes, which are listed in <a href="AppStartupAndStop.html#925752">Table 3.1</a> at the end of this chapter. In addition, developers can create their own launch codes to implement specific functionality. Both the sending and the receiving application must know about and handle any developer-defined launch codes. <a name="925250"> </a><p></p><dt>The launch code parameter is a 16-bit word value. All launch codes with values 0-32767 are reserved for use by the system and for future enhancements. Launch codes 32768-65535 are available for private use by applications.</dl><a name="925252"> </a><h2> Stopping an Application </h2><dl><a name="925253"> </a><p></p><dt>An application shuts itself down when it receives the event <code><a href="EventRef.html#925387"></code>appStopEvent<code></a></code>. Note that this is an event, not a launch code. The application must detect this event and terminate. (You'll learn more about events in the next chapter.) <a name="925257"> </a><p></p><dt>When an application stops, it is given an opportunity to perform cleanup activities including closing databases and saving state information. <a name="925258"> </a><p></p><dt>In the stop routine, an application should first flush all active records, then close the application's database, and finally save those aspects of the current state needed for startup. <a href="AppStartupAndStop.html#925263">Listing 3.3</a> is an example of a <code>StopApplication</code> routine from <code>Datebook.c</code>. </dl><a name="925263"> </a><h4>Listing 3.3	 StopApplication from Datebook.c</h4><a name="925265"> </a><hr><code>static void StopApplication (void)</code><br><a name="925266"> </a><code>{</code><br><a name="925267"> </a><code>&nbsp&nbsp&nbsp DatebookPreferenceType prefs;</code><br><a name="925268"> </a><code>&nbsp&nbsp&nbsp </code><br><a name="925269"> </a><code>&nbsp&nbsp&nbsp // Write the preferences / saved-state information.</code><br><a name="925270"> </a><code>&nbsp&nbsp&nbsp prefs.noteFont = NoteFont;</code><br><a name="925271"> </a><code>&nbsp&nbsp&nbsp prefs.dayStartHour = DayStartHour;</code><br><a name="925272"> </a><code>&nbsp&nbsp&nbsp prefs.dayEndHour = DayEndHour;</code><br><a name="925273"> </a><code>&nbsp&nbsp&nbsp prefs.alarmPreset = AlarmPreset;</code><br><a name="925274"> </a><code>&nbsp&nbsp&nbsp prefs.saveBackup = SaveBackup;</code><br><a name="925275"> </a><code>&nbsp&nbsp&nbsp prefs.showTimeBars = ShowTimeBars;</code><br><a name="925276"> </a><code>&nbsp&nbsp&nbsp prefs.compressDayView = CompressDayView;</code><br><a name="925277"> </a><code>&nbsp&nbsp&nbsp prefs.showTimedAppts = ShowTimedAppts;</code><br><a name="925278"> </a><code>&nbsp&nbsp&nbsp prefs.showUntimedAppts = ShowUntimedAppts;</code><br><a name="925279"> </a><code>&nbsp&nbsp&nbsp prefs.showDailyRepeatingAppts = ShowDailyRepeatingAppts;</code><br><a name="925280"> </a><code></code><br><a name="925281"> </a><code>&nbsp&nbsp&nbsp // Write the state information.</code><br><a name="925282"> </a><code>&nbsp&nbsp&nbsp PrefSetAppPreferences (sysFileCDatebook, datebookPrefID, <br>	 	 datebookVersionNum, &amp;prefs, sizeof (DatebookPreferenceType), <br>	 	 true);</code><br><a name="925283"> </a><code></code><br><a name="925284"> </a><code>&nbsp&nbsp&nbsp // Send a frmSave event to all the open forms.</code><br><a name="925285"> </a><code>&nbsp&nbsp&nbsp FrmSaveAllForms ();</code><br><a name="925286"> </a><code>&nbsp&nbsp&nbsp </code><br><a name="925287"> </a><code>&nbsp&nbsp&nbsp // Close all the open forms.</code><br><a name="925288"> </a><code>&nbsp&nbsp&nbsp FrmCloseAllForms ();</code><br><a name="925289"> </a><code></code><br><a name="925290"> </a><code>&nbsp&nbsp&nbsp // Close the application's data file.</code><br><a name="925291"> </a><code>&nbsp&nbsp&nbsp DmCloseDatabase (ApptDB);</code><br><a name="925292"> </a><code>}</code><br><hr><br><a name="925294"> </a><h2> Launch Code Summary</h2><dl><a name="925300"> </a><p></p><dt><a href="AppStartupAndStop.html#925752">Table 3.1</a> lists all Palm OS standard launch codes. These launch codes are declared in the header <code>SystemMgr.h</code>. All the parameters for a launch code are passed in a single parameter block, and the results are returned in the same parameter block. <p><a name="925490"> </a> </p><p><div> <table border="3"><caption><B><a name="925752"> </a><h4>Table 3.1	 Palm OS Launch Codes&nbsp;</h4></B></caption><tr><th><a name="925306"> </a><strong>Code</strong></th><th><a name="925308"> </a><strong>Request</strong></th></tr><tr><td><a name="925314"> </a><a href="ScriptPlugin.html#925081">scptLaunchCmdExecuteCmd</a></td><td><a name="925316"> </a>Execute the specified Network login script plugin command.</td></tr><tr><td><a name="925322"> </a><a href="ScriptPlugin.html#925071">scptLaunchCmdListCmds</a></td><td><a name="925324"> </a>Provide information about the commands that your Network script plugin executes.</td></tr><tr><td><a name="925330"> </a><code></code><a href="AppLaunchCodes.html#925097">sysAppLaunchCmdAddRecord</a></td><td><a name="925332"> </a>Add a record to a database.</td></tr><tr><td><a name="925338"> </a><code></code><a href="AppLaunchCodes.html#925171">sysAppLaunchCmdAlarmTriggered</a></td><td><a name="925340"> </a>Schedule next alarm or perform quick actions such as sounding alarm tones.</td></tr><tr><td><a name="925346"> </a><code></code><a href="AppLaunchCodes.html#927737">sysAppLaunchCmdCountryChange</a></td><td><a name="925348"> </a>Respond to country change.</td></tr><tr><td><a name="925354"> </a><code></code><a href="AppLaunchCodes.html#925209">sysAppLaunchCmdDisplayAlarm</a></td><td><a name="925356"> </a>Display specified alarm dialog or perform time-consuming alarm-related actions.</td></tr><tr><td><a name="925362"> </a><code></code><a href="AppLaunchCodes.html#925235">sysAppLaunchCmdExgAskUser</a></td><td><a name="925364"> </a>Let application override display of dialog asking user if they want to receive incoming data via the exchange manager.</td></tr><tr><td><a name="925370"> </a><code></code><a href="AppLaunchCodes.html#925259">sysAppLaunchCmdExgReceiveData</a></td><td><a name="925372"> </a>Notify application that it should receive incoming data via the exchange manager.</td></tr><tr><td><a name="925378"> </a><a href="AppLaunchCodes.html#925279">sysAppLaunchCmdFind</a></td><td><a name="925380"> </a>Find a text string.</td></tr><tr><td><a name="925386"> </a><a href="AppLaunchCodes.html#925328">sysAppLaunchCmdGoto</a></td><td><a name="925388"> </a>Go to a particular record, display it, and optionally select the specified text.</td></tr><tr><td><a name="925394"> </a><a href="AppLaunchCodes.html#925355">sysAppLaunchCmdGoToURL</a></td><td><a name="925396"> </a>Launch Clipper application and open a URL. (Palm VII<sup>&#153;</sup> system only.)</td></tr><tr><td><a name="925402"> </a><a href="AppLaunchCodes.html#925368">sysAppLaunchCmdInitDatabase</a></td><td><a name="925404"> </a>Initialize database.</td></tr><tr><td><a name="925410"> </a><code></code><a href="AppLaunchCodes.html#925390">sysAppLaunchCmdLookup</a></td><td><a name="925412"> </a>Look up data. In contrast to <code>sysAppLaunchCmdFind</code>, a level of indirection is implied. For example, look up a phone number associated with a name.</td></tr><tr><td><a name="925414"> </a>sysAppLaunchCmdNormalLaunch</td><td><a name="925416"> </a>Launch normally. </td></tr><tr><td><a name="925913"> </a><a href="AppLaunchCodes.html#926527">sysAppLaunchCmdNotify</a></td><td><a name="925915"> </a>Broadcast a notification. </td></tr><tr><td><a name="925422"> </a><a href="AppLaunchCodes.html#925405">sysAppLaunchCmdOpenDB</a></td><td><a name="925424"> </a>Launch application and open a database. (Palm VII system only.)</td></tr><tr><td><a name="925430"> </a><a href="AppLaunchCodes.html#925422">sysAppLaunchCmdPanelCalledFromApp</a></td><td><a name="925432"> </a>Tell preferences panel that it was invoked from an application, not the Preferences application.</td></tr><tr><td><a name="925438"> </a><a href="AppLaunchCodes.html#925442">sysAppLaunchCmdReturnFromPanel</a></td><td><a name="925440"> </a>Tell an application that it's restarting after preferences panel had been called. </td></tr><tr><td><a name="925446"> </a><a href="AppLaunchCodes.html#925454">sysAppLaunchCmdSaveData</a></td><td><a name="925448"> </a>Save data. Often sent before find operations. </td></tr><tr><td><a name="925454"> </a><a href="AppLaunchCodes.html#925466">sysAppLaunchCmdSyncNotify</a></td><td><a name="925456"> </a>Notify applications that a HotSync has been completed.</td></tr><tr><td><a name="925462"> </a><a href="AppLaunchCodes.html#925470">sysAppLaunchCmdSystemLock</a></td><td><a name="925464"> </a>Sent to the Security application to request that the system be locked down. </td></tr><tr><td><a name="925470"> </a><a href="AppLaunchCodes.html#925479">sysAppLaunchCmdSystemReset</a></td><td><a name="925472"> </a>Respond to system reset. No UI is allowed during this launch code. </td></tr><tr><td><a name="925478"> </a><a href="AppLaunchCodes.html#925496">sysAppLaunchCmdTimeChange</a></td><td><a name="925481"> </a>Respond to system time change.</td></tr><tr><td><a name="925487"> </a><a href="AppLaunchCodes.html#925501">sysAppLaunchCmdURLParams</a></td><td><a name="925489"> </a>Launch an application with parameters from Clipper. (Palm VII system only.)</td></tr></table><table><tr><td></table></div></p><a name="925513"> </a><p></p><dt><strong></strong></dl><hr><br><center><B>Palm OS Programmer's Companion</B></center><br><TABLE WIDTH="100%">  <TR>    <TD WIDTH=10%>&nbsp</TD>    <TD WIDTH=20%><a href="Design.html"><IMG SRC="images/prev.html" BORDER=0 ALT="Previous Page"></TD>    <TD WIDTH=20%><a href="CompanionTOC.html"><IMG SRC="images/content.gif" BORDER=0 ALT="Table of Contents"></TD>    <TD WIDTH=20%><a href="CompanionIX.html"><IMG SRC="images/index.gif" BORDER=0 ALT="Index"></TD>    <TD WIDTH=20%><a href="EventLoop.html"><IMG SRC="images/next.html" BORDER=0 ALT="Next Page"></TD>    <TD WIDTH=10%>&nbsp</TD>  </TR></TABLE><br><small><em>This is page 72 of 85 in this book</em></small><hr><br><address><a href="http://www.palmos.com/dev/">Palm Computing Platform Development Zone</a></address><i>Copyright &#169; 2000, Palm, Inc.   All rightsreserved.</i><!-- This file was created with Quadralay WebWorks Publisher 5.0.2 --><!-- --><!-- For more information on how this document, and how the rest of --><!-- this server was created, email devsupp@palm.com --><!-- --><!-- Last updated: 03/27/00 21:29:33 --></body>
<!-- Mirrored from users.fuw.edu.pl/~michalj/palmos/AppStartupAndStop.html by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 17 Feb 2015 19:10:04 GMT -->
</html>