<html>
<!-- Mirrored from users.fuw.edu.pl/~michalj/palmos/FilesAndDatabases.html by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 17 Feb 2015 19:10:12 GMT -->
<head><title>Files and Databases</title></head><body bgcolor="#ffffff"><TABLE WIDTH="100%">  <TR>    <TD WIDTH=25%><a href="Memory.html"><IMG SRC="images/prev.html" BORDER=0 ALT="Previous Page"></TD>    <TD WIDTH=25%><a href="CompanionTOC.html"><IMG SRC="images/content.gif" BORDER=0 ALT="Table of Contents"></TD>    <TD WIDTH=25%><a href="CompanionIX.html"><IMG SRC="images/index.gif" BORDER=0 ALT="Index"></TD>    <TD WIDTH=25%><a href="SystemFeatures.html"><IMG SRC="images/next.html" BORDER=0 ALT="Next Page"></TD>  </TR></TABLE><br><center><B>Palm OS Programmer's Companion</B></center><hr><br><a name="924904"> </a><h1><IMG SRC="images/PCPplain.gif" ALT="Palm Logo" WIDTH="45" HEIGHT="44"> <a name="924902"> </a>7 Files and Databases</h1><dl><a name="924905"> </a><p></p><dt>This chapter describes how to work with databases using Palm OS<sup>&#174;</sup> managers. <ul type="SQUARE"><a name="924909"> </a><br><li><a href="FilesAndDatabases.html#924919">The Data Manager</a> manages user data, which is stored in databases for convenient access.<br><a name="924913"> </a><br><li><a href="FilesAndDatabases.html#925126">The Resource Manager</a> can be used by applications to conveniently retrieve and save chunks of data. It's similar to the data manager, but has the added capability of tagging each chunk with a unique resource type and ID. These tagged data chunks, called resources, are stored in resource databases. Resources are typically used to store the application's user interface elements, such as images, fonts, or dialog layouts. <br><a name="924917"> </a><br><li><a href="FilesAndDatabases.html#925251">File Streaming Application Program Interface</a> can be used by applications to handle large blocks of data. <br></ul></dl><a name="924919"> </a><h2> The Data Manager</h2><dl><a name="924921"> </a><p></p><dt>A traditional file system first reads all or a portion of a file into a memory buffer from disk, using and/or updating the information in the memory buffer, and then writes the updated memory buffer back to disk. Because Palm OS devices have limited amounts of dynamic RAM and use nonvolatile RAM instead of disk storage, a traditional file system is not optimal for storing and retrieving Palm OS user data. <a name="924922"> </a><p></p><dt>Palm OS accesses and updates all information in place. This works well because it reduces dynamic memory requirements and eliminates the overhead of transferring the data to and from another memory buffer involved in a file system. <a name="924923"> </a><p></p><dt>As a further enhancement, data in the Palm OS device is broken down into multiple, finite-size <strong>records</strong> that can be left scattered throughout the memory space; thus, adding, deleting, or resizing a record does not require moving other records around in memory. Each record in a database is in fact a memory manager chunk. The data manager uses memory manager functions to allocate, delete, and resize database records.<a name="924925"> </a><p></p><dt>This section explains how to use the database manager by discussing these topics: <ul type="SQUARE"><a name="924929"> </a><br><li><a href="FilesAndDatabases.html#924939">Records and Databases</a><br><a name="924933"> </a><br><li><a href="FilesAndDatabases.html#924953">Structure of a Database Header</a><br><a name="924937"> </a><br><li><a href="FilesAndDatabases.html#925019">Using the Data Manager</a><br></ul></dl><a name="924939"> </a><h3> Records and Databases</h3><dl><a name="924940"> </a><p></p><dt>Databases organize related records; every record belongs to one and only one database. A database may be a collection of all address book entries, all datebook entries, and so on. A Palm OS application can create, delete, open, and close databases as necessary, just as a traditional file system can create, delete, open, and close a traditional file. There is no restriction on where the records for a particular database reside as long as they all reside on the same memory card. The records from one database can be interspersed with the records from one or more other databases in memory.<a name="924942"> </a><p></p><dt>Storing data by database fits nicely with the Palm OS memory manager design. All heaps except for the dynamic heap(s) are nonvolatile, so database records can be stored in any heap except the dynamic heap(s) (see <a href="Memory.html#925054">"Heap Overview"</a> in the <a href="Memory.html#924904">"Memory"</a> chapter). Because records can be stored anywhere on the memory card, databases can be distributed over multiple discontiguous areas of physical RAM.</dl><a name="924949"> </a><h4> Accessing Data With Local IDs</h4><dl><a name="924950"> </a><p></p><dt>A database maintains a list of all records that belong to it by storing the local ID of each record in the database header. Because local IDs are used, the memory card can be placed into any memory slot of a Palm OS device. An application finds a particular record in a database by index. When an application requests a particular record, the data manager fetches the local ID of the record from the database header by index, converts the local ID to a handle using the card number that contains the database header, and returns the handle to the record.</dl><a name="924953"> </a><h3> Structure of a Database Header</h3><dl><a name="924954"> </a><p></p><dt>A database header consists of some basic database information and a list of records in the database. Each record entry in the header has the local ID of the record, 8 attribute bits, and a 3-byte unique ID for the record. <a name="924956"> </a><p></p><dt>This section provides information about database headers, discussing these topics:<ul type="SQUARE"><a name="924960"> </a><br><li><a href="FilesAndDatabases.html#924967">Database Header Fields</a> <br><a name="924964"> </a><br><li><a href="FilesAndDatabases.html#925007">Structure of a Record Entry in a Database Header</a><br><a name="924965"> </a><blockquote><br><hr><br><em><strong>IMPORTANT:  </strong></em>Expect the database header structure to change in the future. Use the API to work with database structures.<br><hr><br></blockquote></ul></dl><a name="924967"> </a><h4> Database Header Fields</h4><dl><a name="924969"> </a><p></p><dt>The database header has the following fields: <ul type="SQUARE"><a name="924970"> </a><br><li>The <code>name</code> field holds the name of the database. <br><a name="924971"> </a><br><li>The <code>attributes</code> field has flags for the database. <br><a name="924972"> </a><br><li>The <code>version</code> field holds an application-specific version number for that database. <br><a name="924973"> </a><br><li>The <code>modificationNumber</code> is incremented every time a record in the database is deleted, added, or modified. Thus applications can quickly determine if a shared database has been modified by another process. <br><a name="924974"> </a><br><li>The <code>appInfoID</code> is an optional field that an application can use to store application-specific information about the database. For example, it might be used to store user display preferences for a particular database. <br><a name="924975"> </a><br><li>The <code>sortInfoID</code> is another optional field an application can use for storing the local ID of a sort table for the database. <br><a name="924976"> </a><br><li>The <code>type</code> and <code>creator</code> fields are each 4 bytes and hold the database type and creator. The system uses these fields to distinguish application databases from data databases and to associate data databases with the appropriate application. <br><a name="924977"> </a><br><li>The <code>numRecords</code> field holds the number of record entries stored in the database header itself. If all the record entries cannot fit in the header, then <code>nextRecordList</code> has the local ID of a recordList that contains the next set of records. <br><dl><a name="924978"> </a><p></p><dt>Each record entry stored in a record list has three fields and is 8 bytes in length. Each entry has the local ID of the record which takes up 4 bytes: 1 byte of attributes and a 3-byte unique ID for the record. The <code>attribute</code> field, shown in <a href="FilesAndDatabases.html#924983">Figure 7.1</a>, is 8 bits long and contains 4 flags and a 4-bit category number. The category number is used to place records into user-defined categories like "business" or "personal." </dl></ul></dl><a name="924983"> </a><h4>Figure 7.1	 Record Attributes</h4><p><a name="925005"> </a><img src="images/FilesAndDatabasesa.gif" height="178" width="481"></p><a name="925007"> </a><h4> Structure of a Record Entry in a Database Header</h4><dl><a name="925008"> </a><p></p><dt>Each record entry has the local ID of the record, 8 attribute bits, and a 3-byte unique ID for the record. <ul type="SQUARE"><a name="925009"> </a><br><li>Local IDs make the database slot-independent. Since all records for a database reside on the same memory card as the header, the handle of any record in the database can be quickly calculated. When an application requests a specific record from a database, the data manager returns a handle to the record that it determines from the stored local ID.<br><dl><a name="925010"> </a><p></p><dt>A special situation occurs with ROM-based databases. Because ROM-based heaps use nonmovable chunks exclusively, the local IDs to records in a ROM-based database are local IDs of pointers, not handles. So, when an application opens a ROM-based database, the data manager allocates and initializes a fake handle for each record and returns the appropriate fake handle when the application requests a record. Because of this, applications can use handles to access both RAM- and ROM-based database records.</dl><a name="925011"> </a><br><li>The unique ID must be unique for each record within a database. It remains the same for a particular record no matter how many times the record is modified. It is used during synchronization with the desktop to track records on the Palm OS device with the same records on the desktop system.<br></ul><a name="925012"> </a><p></p><dt>When the user deletes or archives a record on Palm OS: <ul type="SQUARE"><a name="925013"> </a><br><li>The <code>delete</code> bit is set in the <code>attributes</code> flags, but its entry in the database header remains until the next synchronization with the PC. <br><a name="925014"> </a><br><li>The <code>dirty</code> bit is set whenever a record is updated.<br><a name="925015"> </a><br><li>The <code>busy</code> bit is set when an application currently has a record locked for reading or writing.<br><a name="925016"> </a><br><li>The <code>secret</code> bit is set for records that should not be displayed before the user password has been entered on the device.<br></ul><a name="925017"> </a><p></p><dt>When a user "deletes" a record on the Palm OS device, the record's data chunk is freed, the local ID stored in the record entry is set to 0, and the <code>delete</code> bit is set in the attributes. When the user archives a record, the deleted bit is also set but the chunk is not freed and the local ID is preserved. This way, the next time the user synchronizes with the desktop system, the desktop can quickly determine which records to delete (since their record entries are still around on the Palm OS device). In the case of archived records, the desktop can save the record data on the PC before it permanently removes the record entry and data from the Palm OS device. For deleted records, the PC just has to delete the same record from the PC before permanently removing the record entry from the Palm OS device.</dl><a name="925019"> </a><h3> Using the Data Manager</h3><dl><a name="925021"> </a><p></p><dt>Using the data manager is similar to using a traditional file manager, except that the data is broken down into multiple records instead of being stored in one contiguous chunk. To create or delete a database, call <a href="DataAndResourceManager.html#925437">DmCreateDatabase</a> and <a href="DataAndResourceManager.html#988040">DmDeleteDatabase</a>.<a name="925030"> </a><p></p><dt>Each memory card is akin to a disk drive and can contain multiple databases. To open a database for reading or writing, you must first get the database ID, which is simply the local ID of the database header. Calling <a href="DataAndResourceManager.html#925838">DmFindDatabase</a> searches a particular memory card for a database by name and returns the local ID of the database header. Alternatively, calling <a href="DataAndResourceManager.html#926063">DmGetDatabase</a> returns the database ID for each database on a card by index. <a name="925039"> </a><p></p><dt>After determining the database ID, you can open the database for read-only or read/write access. When you open a database, the system locks down the database header and returns a reference to a database access structure, which tracks information about the open database and caches certain information for optimum performance. The database access structure is a relatively small structure (less than 100 bytes) allocated in the dynamic heap that is disposed of when the database is closed.<a name="925048"> </a><p></p><dt>Call <a href="DataAndResourceManager.html#925528">DmDatabaseInfo</a>, <a href="DataAndResourceManager.html#927326">DmSetDatabaseInfo</a>, and <a href="DataAndResourceManager.html#925619">DmDatabaseSize</a> to query or set information about a database, such as its name, size, creation and modification dates, attributes, type, and creator. <a name="925065"> </a><p></p><dt>Call <a href="DataAndResourceManager.html#926284">DmGetRecord</a>, <a href="DataAndResourceManager.html#926888">DmQueryRecord</a>, and <a href="DataAndResourceManager.html#926964">DmReleaseRecord</a> when viewing or updating a database. <ul type="SQUARE"><a name="925070"> </a><br><li><a href="DataAndResourceManager.html#926284">DmGetRecord</a> takes a record index as a parameter, marks the record busy, and returns a handle to the record. If a record is already busy when <a href="DataAndResourceManager.html#926284">DmGetRecord</a> is called, an error is returned. <br><a name="925077"> </a><br><li><a href="DataAndResourceManager.html#926888">DmQueryRecord</a> is faster if the application only needs to view the record; it doesn't check or set the busy bit, so it's not necessary to call <code>DmReleaseRecord</code> when finished viewing the record. <br><a name="925081"> </a><br><li><a href="DataAndResourceManager.html#926964">DmReleaseRecord</a> clears the <code>busy</code> bit, and updates the modification number of the database and marks the record dirty if the <code>dirty</code> parameter is true.<br></ul><a name="925082"> </a><p></p><dt>To resize a record to grow or shrink its contents, call <a href="DataAndResourceManager.html#927127">DmResizeRecord</a>. This routine automatically reallocates the record in another heap of the same card if the current heap does not have enough space for it. Note that if the data manager needs to move the record into another heap to resize it, the handle to the record changes. <a href="DataAndResourceManager.html#927127">DmResizeRecord</a> returns the new handle to the record.<a name="925093"> </a><p></p><dt>To add a new record to a database, call <a href="DataAndResourceManager.html#926489">DmNewRecord</a>. This routine can insert the new record at any index position, append it to the end, or replace an existing record by index. It returns a handle to the new record. <a name="925094"> </a><p></p><dt>There are three methods for removing a record: <code>DmRemoveRecord</code>, <code>DmDeleteRecord</code>, and <code>DmArchiveRecord.</code><ul type="SQUARE"><a name="925098"> </a><br><li><a href="DataAndResourceManager.html#927011">DmRemoveRecord</a> removes the record's entry from the database header and disposes of the record data. <br><a name="925102"> </a><br><li><a href="DataAndResourceManager.html#925735">DmDeleteRecord</a> also disposes of the record data, but instead of removing the record's entry from the database header, it sets the deleted bit in the record entry attributes field and clears the local chunk ID. <br><a name="925106"> </a><br><li><a href="DataAndResourceManager.html#925271">DmArchiveRecord</a> does not dispose of the record's data; it just sets the deleted bit in the record entry. <br></ul><a name="925107"> </a><p></p><dt>Both <code>DmDeleteRecord</code> and <code>DmArchiveRecord</code> are useful for synchronizing information with a desktop PC. Since the unique ID of the deleted or archived record is still kept in the database header, the desktop PC can perform the necessary operations on its own copy of the database before permanently removing the record from the Palm OS database.<a name="925114"> </a><p></p><dt>Call <a href="DataAndResourceManager.html#926934">DmRecordInfo</a> and <a href="DataAndResourceManager.html#927381">DmSetRecordInfo</a> to retrieve or set the record information stored in the database header, such as the attributes, unique ID, and local ID of the record. Typically, these routines are used to set or retrieve the category of a record that is stored in the lower four bits of the record's attribute field.<a name="925115"> </a><p></p><dt>To move records from one index to another or from one database to another, call <a href="DataAndResourceManager.html#926453">DmMoveRecord</a>, <a href="DataAndResourceManager.html#925300">DmAttachRecord</a>, and <a href="DataAndResourceManager.html#925769">DmDetachRecord</a>. <code>DmDetachRecord</code> removes a record entry from the database header and returns the record handle. Given the handle of a new record, <code>DmAttachRecord</code> inserts or appends that new record to a database or replaces an existing record with the new record. <code>DmMoveRecord</code> is an optimized way to move a record from one index to another in the same database.</dl><a name="925126"> </a><h2> The Resource Manager</h2><dl><a name="925128"> </a><p></p><dt>Applications can use the resource manager much like the data manager to retrieve and save chunks of data conveniently. The resource manager has the added capability of tagging each chunk of data with a unique resource type and resource ID. These tagged data chunks, called <strong>resources</strong>, are stored in resource databases. Resource databases are almost identical in structure to normal databases except for a slight amount of increased storage overhead per resource record (two extra bytes). In fact, the resource manager is nothing more than a subset of routines in the data manager that are broken out here for conceptual reasons only.<a name="925132"> </a><p></p><dt>Resources are typically used to store the user interface elements of an application, such as images, fonts, dialog layouts, and so forth. Part of building an application involves creating these resources and merging them with the actual executable code. In the Palm OS environment, an application is, in fact, simply a resource database with the executable code stored as one or more code resources and the graphics elements and other miscellaneous data stored in the same database as other resource types.<a name="925133"> </a><p></p><dt>Applications may also find the resource manager useful for storing and retrieving application preferences, saved window positions, state information, and so forth. These preferences settings can be stored in a separate resource database. <a name="925134"> </a><p></p><dt>This section explains how to work with the resource manager and discusses these topics: <ul type="SQUARE"><a name="925138"> </a><br><li><a href="FilesAndDatabases.html#925148">Structure of a Resource Database Header</a><br><a name="925142"> </a><br><li><a href="FilesAndDatabases.html#925160">Using the Resource Manager</a><br><a name="925146"> </a><br><li><a href="FilesAndDatabases.html#925561">Resource Manager Functions</a><br></ul></dl><a name="925148"> </a><h3> Structure of a Resource Database Header</h3><dl><a name="925150"> </a><p></p><dt>A resource database header consists of some general database information followed by a list of resources in the database. The first portion of the header is identical in structure to a normal database header. Resource database headers are distinguished from normal database headers by the <code>dmHdrAttrResDB</code> bit in the <code>attributes</code> field. <a name="925151"> </a><blockquote><br><hr><br><em><strong>IMPORTANT:  </strong></em>Expect the resource database header structure to change in the future. Use the API to work with resource database structures.<br><hr><br></blockquote><ul type="SQUARE"><a name="925152"> </a><br><li>The <code>name</code> field holds the name of the resource database. <br><a name="925153"> </a><br><li>The <code>attributes</code> field has flags for the database and always has the <code>dmHdrAttrResDB</code> bit set. <br><a name="925154"> </a><br><li>The <code>modificationNumber</code> is incremented every time a resource in the database is deleted, added, or modified. Thus, applications can quickly determine if a shared resource database has been modified by another process.<br><a name="925155"> </a><br><li>The <code>appInfoID</code> and <code>sortInfoID</code> fields are not normally needed for a resource database but are included to match the structure of a regular database. An application may optionally use these fields for its own purposes. <br><a name="925156"> </a><br><li>The <code>type</code> and <code>creator</code> fields hold 4-byte signatures of the database <code>type</code> and <code>creator</code> as defined by the application that created the database.<br><a name="925157"> </a><br><li>The <code>numResources</code> field holds the number of resource info entries that are stored in the header itself. In most cases, this is the total number of resources. If all the resource info entries cannot fit in the header, however, then <code>nextResourceList</code> has the <code>chunkID</code> of a <code>resourceList</code> that contains the next set of resource info entries.<br></ul><a name="925158"> </a><p></p><dt>Each 10-byte resource info entry in the header has the resource type, the resource ID, and the local ID of the memory manager chunk that contains the resource data. </dl><a name="925160"> </a><h3> Using the Resource Manager</h3><dl><a name="925162"> </a><p></p><dt>You can create, delete, open, and close resource databases with the routines used to create normal record-based databases (see <a href="FilesAndDatabases.html#925019">Using the Data Manager</a>). This includes all database-level (not record-level) routines in the data manager such as <a href="DataAndResourceManager.html#925437">DmCreateDatabase</a>, <a href="DataAndResourceManager.html#988040">DmDeleteDatabase</a>, <a href="DataAndResourceManager.html#925528">DmDatabaseInfo</a>, and so on. <a name="925181"> </a><p></p><dt>When you create a new database using <a href="DataAndResourceManager.html#925437">DmCreateDatabase</a>, the type of database created (record or resource) depends on the value of the <code>resDB</code> parameter. If set, a resource database is created and the <code>dmHdrAttrResDB</code> bit is set in the <code>attributes</code> field of the database header. Given a database header ID, an application can determine which type of database it is by calling <a href="DataAndResourceManager.html#925528">DmDatabaseInfo</a> and examining the <code>dmHdrAttrResDB</code> bit in the returned <code>attributes</code> field.<a name="925185"> </a><p></p><dt>Once a resource database has been opened, an application can read and manipulate its resources by using the resource-based access routines of the resource manager. Generally, applications use the <a href="DataAndResourceManager.html#926326">DmGetResource</a> and <a href="DataAndResourceManager.html#926987">DmReleaseResource</a> routines.<a name="925196"> </a><p></p><dt><a href="DataAndResourceManager.html#926326">DmGetResource</a><code> r</code>eturns a handle to a resource, given the type and ID. This routine searches all open resource databases for a resource of the given type and ID, and returns a handle to it. The search starts with the most recently opened database. To search only the most recently opened resource database for a resource instead of all open resource databases, call <a href="DataAndResourceManager.html#964506">DmGet1Resource</a>. <a name="925203"> </a><p></p><dt><a href="DataAndResourceManager.html#926987">DmReleaseResource</a><code> </code>should be called as soon as an application finishes reading or writing the resource data. To resize a resource, call <code><a href="DataAndResourceManager.html#927150"></code>DmResizeResource<code></a></code>, which accepts a handle to a resource and reallocates the resource in another heap of the same card if necessary. It returns the handle of the resource, which might have been changed if the resource had to be moved to another heap to be resized.<a name="925207"> </a><p></p><dt>The remaining resource manager routines are usually not required for most applications. These include functions to get and set resource attributes, move resources from one database to another, get resources by index, and create new resources. Most of these functions reference resources by index to optimize performance. When referencing a resource by index, the <code>DmOpenRef </code>of the open resource database that the resource belongs to must also be specified. Call <a href="DataAndResourceManager.html#927232">DmSearchResource</a> to find a resource by type and ID or by pointer by searching in all open resource databases.<a name="925211"> </a><p></p><dt>To get the <code>DmOpenRef</code> of the topmost open resource database, call <a href="DataAndResourceManager.html#926581">DmNextOpenResDatabase</a> and pass nil as the current <code>DmOpenRef</code>. To find out the <code>DmOpenRef</code> of each successive database, call <code>DmNextOpenResDatabase</code> repeatedly with each successive <code>DmOpenRef</code>.<a name="925215"> </a><p></p><dt>Given the access pointer of a specific open resource database, <a href="DataAndResourceManager.html#925894">DmFindResource</a> can be used to return the index of a resource, given its type and ID. <a href="DataAndResourceManager.html#925935">DmFindResourceType</a> can be used to get the index of every resource of a given type. To get a resource handle by index, call <a href="DataAndResourceManager.html#926356">DmGetResourceIndex</a>.<a name="925225"> </a><p></p><dt>To determine how many resources are in a given database, call <a href="DataAndResourceManager.html#926678">DmNumResources</a>. To get and set attributes of a resource including its type and ID, call <a href="DataAndResourceManager.html#927172">DmResourceInfo</a> and <a href="DataAndResourceManager.html#927412">DmSetResourceInfo</a>. To attach an existing data chunk to a resource database as a new resource, call <a href="DataAndResourceManager.html#925347">DmAttachResource</a>. To detach a resource from a database, call <a href="DataAndResourceManager.html#925808">DmDetachResource</a>.<a name="925246"> </a><p></p><dt>To create a new resource, call <a href="DataAndResourceManager.html#926527">DmNewResource</a> and pass the desired size, type, and ID of the new resource. To delete a resource, call <a href="DataAndResourceManager.html#927044">DmRemoveResource</a>. Removing a resource disposes of its data chunk and removes its entry from the database header.</dl><a name="925251"> </a><h2> File Streaming Application Program Interface</h2><dl><a name="925252"> </a><p></p><dt>The file streaming functions in Palm OS 3.0 and later let you work with large blocks of data. File streams can be arbitrarily large--they are not subject to the 64 KB maximum size limit imposed by the memory manager on allocated objects. File streams can be used for permanent data storage; in Palm OS 3.0, their underlying implementation is a Palm OS database. You can read, write, seek to a specified offset, truncate, and do everything else you'd expect to do with a desktop-style file. <a name="925253"> </a><p></p><dt>Other than backup/restore, Palm OS does not provide direct Hot Sync support for file streams, and none is planned at this time. <a name="925254"> </a><p></p><dt>The use of double-buffering imposes a performance penalty on file streams that may make them unsuitable for certain applications. Record-intensive applications tend to obtain better performance from the Data Manager.</dl><a name="925255"> </a><h3> Using the File Streaming API</h3><dl><a name="925256"> </a><p></p><dt>The File Streaming API is derived from the C programming language's <code>&lt;stdio.h&gt;</code> interface. Any C book that explains the <code>&lt;stdio.h&gt;</code> interface should serve as a suitable introduction to the concepts underlying the Palm OS File Streaming API. This section provides only a brief overview of the most commonly used file streaming functions. <a name="925263"> </a><p></p><dt>The <a href="FileStreaming.html#925457">FileOpen</a> function opens a file, and the <a href="FileStreaming.html#925497">FileRead</a> function reads it. The semantics of <a href="FileStreaming.html#925497">FileRead</a> and <a href="FileStreaming.html#925672">FileWrite</a> are just like their <code>&lt;stdio.h&gt;</code> equivalents, the <code>fread</code> and <code>fwrite</code> functions. The other <code>&lt;stdio.h&gt;</code> routines have obvious analogs in the File Streaming API as well.<a name="925270"> </a><p></p><dt>For example,<dl><a name="925271"> </a><br><code>theStream = FileOpen(cardId,"KillerAppDataFile", 	 	 <br>	 	 	 	 	 	 'KILR', 'KILD', fileModeReadOnly,<br>	 	 	 	 	 	 &amp;err); </code><br><dl><a name="925272"> </a><p></p><dt>As on a desktop, the filename is the unique item. The creator ID and file type are for informational purposes and your code may require that an opened file have the correct type and creator.<a name="925276"> </a><p></p><dt>Normally, the <a href="FileStreaming.html#925457">FileOpen</a> function returns an error when it attempts to open or replace an existing stream having a type and creator that do not match those specified. To suppress this error, pass the <code>fileModeAnyTypeCreator </code>selector as a flag in the <code>openMode</code> parameter to the <a href="FileStreaming.html#925457">FileOpen</a> function. <a name="925283"> </a><p></p><dt>To read data, use the <a href="FileStreaming.html#925497">FileRead</a> function as in the following example: </dl><a name="925284"> </a><br><code>FileRead(theStream, &amp;buf, objSize, numObjs,<br>	 	 	 	 &amp;err); </code><br><dl><a name="925285"> </a><p></p><dt>To free the memory used to store stream data as the data is read, you can use the <a href="FileStreaming.html#925038">FileControl</a> function to switch the stream to destructive read mode. This mode is useful for manipulating temporary data; for example, destructive read mode would be ideal for adding the objects in a large data stream to a database when sufficient memory for duplicating the entire file stream is not available. You can switch a stream to destructive read mode by passing the <code>fileOpDestructiveReadMode</code> selector as the value of the <code>op</code> parameter to the <a href="FileStreaming.html#925038">FileControl</a> function. <a name="925295"> </a><p></p><dt>The <code><a href="FileStreaming.html#925284"></code>FileDmRead<code></a></code> function can read data directly into a Database Manager chunk for immediate addition to a Palm OS database.</dl></dl></dl><a name="925297"> </a><h2> Summary of Files and Databases</h2><p><a name="925557"> </a> </p><p><div> <table border="3"><caption><B></B></caption><tr><th><a name="925300"> </a><strong>Data Manager Functions</strong></th><th><a name="925302"> </a><strong></strong></th></tr><tr><td><a name="925304"> </a><strong>Creating Databases</strong></td><td><a name="925306"> </a></td></tr><tr><td><a name="925311"> </a><a href="DataAndResourceManager.html#925437">DmCreateDatabase</a></td><td><a name="925316"> </a><a href="DataAndResourceManager.html#925506">DmCreateDatabaseFromImage</a></td></tr><tr><td colspan=2 rowspan=1><a name="925318"> </a><strong>Opening and Closing Databases</strong></td></tr><tr><td><a name="925325"> </a><a href="DataAndResourceManager.html#926691">DmOpenDatabase</a><br><a href="DataAndResourceManager.html#925592">DmDatabaseProtect</a></td><td><a name="925336"> </a><a href="DataAndResourceManager.html#925393">DmCloseDatabase</a><br><a href="DataAndResourceManager.html#926762">DmOpenDatabaseByTypeCreator</a></td></tr><tr><td><a name="925344"> </a><strong>Creating Records</strong></td><td><a name="925346"> </a></td></tr><tr><td><a name="925351"> </a><a href="DataAndResourceManager.html#988344">DmNewHandle</a></td><td><a name="925356"> </a><a href="DataAndResourceManager.html#926489">DmNewRecord</a></td></tr><tr><td colspan=2 rowspan=1><a name="925358"> </a><strong>Accessing Records</strong></td></tr><tr><td><a name="925365"> </a><a href="DataAndResourceManager.html#926284">DmGetRecord</a><br><a href="DataAndResourceManager.html#925865">DmFindRecordByID</a></td><td><a name="925373"> </a><a href="DataAndResourceManager.html#926888">DmQueryRecord</a><br><a href="DataAndResourceManager.html#927208">DmSearchRecord</a></td></tr><tr><td><a name="925378"> </a><strong>Adding Records</strong></td><td><a name="925380"> </a></td></tr><tr><td><a name="925385"> </a><a href="DataAndResourceManager.html#925300">DmAttachRecord</a></td><td><a name="925387"> </a></td></tr><tr><td><a name="926395"> </a><strong>Unlocking Records</strong></td><td><a name="926397"> </a></td></tr><tr><td><a name="926403"> </a><a href="DataAndResourceManager.html#926964">DmReleaseRecord</a></td><td><a name="926405"> </a></td></tr><tr><td><a name="925389"> </a><strong>Changing Records</strong></td><td><a name="925391"> </a></td></tr><tr><td><a name="925396"> </a><a href="DataAndResourceManager.html#926453">DmMoveRecord</a><br><a href="DataAndResourceManager.html#927305">DmSet</a><br><a href="DataAndResourceManager.html#927456">DmWrite</a></td><td><a name="925404"> </a><a href="DataAndResourceManager.html#927127">DmResizeRecord</a><br><a href="DataAndResourceManager.html#927435">DmStrCopy</a><br><a href="DataAndResourceManager.html#927475">DmWriteCheck</a></td></tr><tr><td><a name="925409"> </a><strong>Deleting Records</strong></td><td><a name="925411"> </a></td></tr><tr><td><a name="925416"> </a><a href="DataAndResourceManager.html#925271">DmArchiveRecord</a><br><a href="DataAndResourceManager.html#925735">DmDeleteRecord</a><br><a href="DataAndResourceManager.html#927011">DmRemoveRecord</a></td><td><a name="925430"> </a><a href="DataAndResourceManager.html#988040">DmDeleteDatabase</a><br><a href="DataAndResourceManager.html#925769">DmDetachRecord</a><br><a href="DataAndResourceManager.html#927088">DmRemoveSecretRecords</a></td></tr><tr><td><a name="925438"> </a><strong>Sorting</strong></td><td><a name="925440"> </a></td></tr><tr><td><a name="925445"> </a><a href="DataAndResourceManager.html#926411">DmInsertionSort</a><br><a href="DataAndResourceManager.html#925972">DmFindSortPosition</a></td><td><a name="925453"> </a><a href="DataAndResourceManager.html#926011">DmFindSortPositionV10</a><br><a href="DataAndResourceManager.html#926904">DmQuickSort</a></td></tr><tr><td><a name="925458"> </a><strong>Categories</strong></td><td><a name="925460"> </a></td></tr><tr><td><a name="925465"> </a><a href="DataAndResourceManager.html#926435">DmMoveCategory</a><br><a href="DataAndResourceManager.html#925651">DmDeleteCategory</a><br><a href="DataAndResourceManager.html#926854">DmQueryNextInCategory</a></td><td><a name="925476"> </a><a href="DataAndResourceManager.html#926646">DmNumRecordsInCategory</a><br><a href="DataAndResourceManager.html#926822">DmPositionInCategory</a><br><a href="DataAndResourceManager.html#927265">DmSeekRecordInCategory</a></td></tr><tr><td><a name="925484"> </a><strong>Locating Databases</strong></td><td><a name="925486"> </a></td></tr><tr><td><a name="925491"> </a><a href="DataAndResourceManager.html#925838">DmFindDatabase</a><br><a href="DataAndResourceManager.html#926063">DmGetDatabase</a><br><a href="DataAndResourceManager.html#926559">DmNextOpenDatabase</a></td><td><a name="925501"> </a><a href="DataAndResourceManager.html#926215">DmGetNextDatabaseByTypeCreator</a></td></tr><tr><td><a name="925504"> </a><strong>Database Information</strong></td><td><a name="925506"> </a></td></tr><tr><td><a name="925511"> </a><a href="DataAndResourceManager.html#925528">DmDatabaseInfo</a><br><a href="DataAndResourceManager.html#926934">DmRecordInfo</a><br><a href="DataAndResourceManager.html#926795">DmOpenDatabaseInfo</a><br><a href="DataAndResourceManager.html#926599">DmNumDatabases</a></td><td><a name="925525"> </a><a href="DataAndResourceManager.html#927326">DmSetDatabaseInfo</a><br><a href="DataAndResourceManager.html#927381">DmSetRecordInfo</a><br><a href="DataAndResourceManager.html#925619">DmDatabaseSize</a><br><a href="DataAndResourceManager.html#926624">DmNumRecords</a></td></tr><tr><td><a name="925536"> </a><strong>Application Information</strong></td><td><a name="925538"> </a></td></tr><tr><td><a name="925543"> </a><a href="DataAndResourceManager.html#926043">DmGetAppInfoID</a></td><td><a name="925545"> </a></td></tr><tr><td><a name="925547"> </a><strong>Error Handling</strong></td><td><a name="925549"> </a></td></tr><tr><td><a name="925554"> </a><a href="DataAndResourceManager.html#926116">DmGetLastErr</a></td><td><a name="925556"> </a></td></tr></table><table><tr><td></table></div></p><p><a name="925616"> </a> </p><p><div> <table border="3"><caption><B></B></caption><tr><th><a name="925561"> </a><strong>Resource Manager Functions</strong></th><th><a name="925563"> </a><strong></strong></th></tr><tr><td><a name="925568"> </a><a href="DataAndResourceManager.html#957202">DmOpenDBNoOverlay</a><br><a href="DataAndResourceManager.html#926527">DmNewResource</a><br><a href="DataAndResourceManager.html#926987">DmReleaseResource</a><br><a href="DataAndResourceManager.html#925808">DmDetachResource</a><br><a href="DataAndResourceManager.html#927232">DmSearchResource</a><br><a href="DataAndResourceManager.html#925935">DmFindResourceType</a><br><a href="DataAndResourceManager.html#926326">DmGetResource</a><br><a href="DataAndResourceManager.html#926678">DmNumResources</a><br><a href="DataAndResourceManager.html#927172">DmResourceInfo</a></td><td><a name="925594"> </a><a href="DataAndResourceManager.html#925347">DmAttachResource</a><br><a href="DataAndResourceManager.html#927044">DmRemoveResource</a><br><a href="DataAndResourceManager.html#926356">DmGetResourceIndex</a><br><a href="DataAndResourceManager.html#925894">DmFindResource</a><br><a href="DataAndResourceManager.html#964506">DmGet1Resource</a><br><a href="DataAndResourceManager.html#926581">DmNextOpenResDatabase</a><br><a href="DataAndResourceManager.html#927150">DmResizeResource</a><br><a href="DataAndResourceManager.html#927412">DmSetResourceInfo</a></td></tr></table><table><tr><td></table></div></p><p><a name="925720"> </a> </p><p><div> <table border="3"><caption><B></B></caption><tr><th colspan=2 rowspan=1><a name="925620"> </a><strong>File Streaming Function Summary</strong></th></tr><tr><td><a name="925624"> </a><strong>Opening and Closing</strong></td><td><a name="925626"> </a></td></tr><tr><td><a name="925631"> </a><a href="FileStreaming.html#925457">FileOpen</a><br><a href="FileStreaming.html#925582">FileSeek</a></td><td><a name="925639"> </a><a href="FileStreaming.html#925019">FileClose</a></td></tr><tr><td><a name="925641"> </a><strong>Reading Files</strong></td><td><a name="925643"> </a></td></tr><tr><td><a name="925648"> </a><a href="FileStreaming.html#925497">FileRead</a><br><a href="FileStreaming.html#925543">FileRewind</a></td><td><a name="925656"> </a><a href="FileStreaming.html#925284">FileDmRead</a><br><a href="FileStreaming.html#925038">FileControl</a></td></tr><tr><td><a name="925661"> </a><strong>Writing to Files</strong></td><td><a name="925663"> </a></td></tr><tr><td><a name="925668"> </a><a href="FileStreaming.html#925672">FileWrite</a></td><td><a name="925673"> </a><a href="FileStreaming.html#925647">FileTruncate</a></td></tr><tr><td><a name="925675"> </a><strong>File Information</strong></td><td><a name="925677"> </a></td></tr><tr><td><a name="925682"> </a><a href="FileStreaming.html#925330">FileEOF</a></td><td><a name="925687"> </a><a href="FileStreaming.html#925618">FileTell</a></td></tr><tr><td><a name="925689"> </a><strong>Deleting Files</strong></td><td><a name="925691"> </a></td></tr><tr><td><a name="925696"> </a><a href="FileStreaming.html#925259">FileDelete</a></td><td><a name="925701"> </a><a href="FileStreaming.html#925402">FileFlush</a></td></tr><tr><td><a name="925703"> </a><strong>Error Handling</strong></td><td><a name="925705"> </a></td></tr><tr><td><a name="925710"> </a><a href="FileStreaming.html#925366">FileError</a><br><a href="FileStreaming.html#924992">FileClearerr</a></td><td><a name="925718"> </a><a href="FileStreaming.html#925424">FileGetLastError</a><br></td></tr></table><table><tr><td></table></div></p><dl><a name="925737"> </a><p></p><dt><strong></strong></dl><hr><br><center><B>Palm OS Programmer's Companion</B></center><br><TABLE WIDTH="100%">  <TR>    <TD WIDTH=10%>&nbsp</TD>    <TD WIDTH=20%><a href="Memory.html"><IMG SRC="images/prev.html" BORDER=0 ALT="Previous Page"></TD>    <TD WIDTH=20%><a href="CompanionTOC.html"><IMG SRC="images/content.gif" BORDER=0 ALT="Table of Contents"></TD>    <TD WIDTH=20%><a href="CompanionIX.html"><IMG SRC="images/index.gif" BORDER=0 ALT="Index"></TD>    <TD WIDTH=20%><a href="SystemFeatures.html"><IMG SRC="images/next.html" BORDER=0 ALT="Next Page"></TD>    <TD WIDTH=10%>&nbsp</TD>  </TR></TABLE><br><small><em>This is page 76 of 85 in this book</em></small><hr><br><address><a href="http://www.palmos.com/dev/">Palm Computing Platform Development Zone</a></address><i>Copyright &#169; 2000, Palm, Inc.   All rightsreserved.</i><!-- This file was created with Quadralay WebWorks Publisher 5.0.2 --><!-- --><!-- For more information on how this document, and how the rest of --><!-- this server was created, email devsupp@palm.com --><!-- --><!-- Last updated: 03/27/00 21:29:41 --></body>
<!-- Mirrored from users.fuw.edu.pl/~michalj/palmos/FilesAndDatabases.html by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 17 Feb 2015 19:10:13 GMT -->
</html>